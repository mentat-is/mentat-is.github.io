<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <meta name="generator" content="Doxygen 1.12.0" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- BEGIN opengraph metadata -->
        <meta property="og:title" content="gULP! Documentation" />
        <meta
            property="og:image"
            content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452"
        />
        <meta
            property="og:description"
            content="Custom CSS theme for doxygen html-documentation with lots of customization parameters."
        />
        <meta
            property="og:url"
            content="https://github.com/rcskunkworks/gulp"
        />
        <!-- END opengraph metadata -->
        <!-- BEGIN twitter metadata -->
        <meta
            name="twitter:image:src"
            content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452"
        />
        <meta name="twitter:title" content="Mentat" />
        <meta name="twitter:description" content="mentat.is" />
        <!-- END twitter metadata -->
        <title>(g)ULP!: GUiLP</title>
        <link href="tabs.css" rel="stylesheet" type="text/css" />
        <link rel="icon" type="image/svg+xml" href="logo.drawio.svg" />
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="dynsections.js"></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-darkmode-toggle.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-fragment-copy-button.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-paragraph-link.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-interactive-toc.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-tabs.js"
        ></script>
        <script type="text/javascript">
            DoxygenAwesomeFragmentCopyButton.init();
            DoxygenAwesomeDarkModeToggle.init();
            DoxygenAwesomeParagraphLink.init();
            DoxygenAwesomeInteractiveToc.init();
            DoxygenAwesomeTabs.init();
        </script>
        </script>
        <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <script src="https://cdn.jsdelivr.net/npm/mermaid@latest/dist/mermaid.min.js"></script>
        <a
            href="https://github.com/rcskunkworks/gulp"
            class="github-corner"
            title="View source on GitHub"
            target="_blank"
            rel="noopener noreferrer"
        >
            <svg
                viewBox="0 0 250 250"
                width="40"
                height="40"
                style="
                    position: absolute;
                    top: 0;
                    border: 0;
                    right: 0;
                    z-index: 99;
                "
                aria-hidden="true"
            >
                <path
                    d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"
                ></path>
                <path
                    d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                    fill="currentColor"
                    style="transform-origin: 130px 106px"
                    class="octo-arm"
                ></path>
                <path
                    d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                    fill="currentColor"
                    class="octo-body"
                ></path></svg
        ></a>
        <style>
            .github-corner:hover .octo-arm {
                animation: octocat-wave 560ms ease-in-out;
            }
            @keyframes octocat-wave {
                0%,
                100% {
                    transform: rotate(0);
                }
                20%,
                60% {
                    transform: rotate(-25deg);
                }
                40%,
                80% {
                    transform: rotate(10deg);
                }
            }
            @media (max-width: 500px) {
                .github-corner:hover .octo-arm {
                    animation: none;
                }
                .github-corner .octo-arm {
                    animation: octocat-wave 560ms ease-in-out;
                }
            }
        </style>
        <div id="top">
            <!-- do not remove this div, it is closed by doxygen! -->
            <div id="titlearea">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr style="height: 56px">
                            <td id="projectalign" style="padding-left: 0.5em">
                                <div id="projectname">
                                    (g)ULP!
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- end header part -->
        </div>
    </body>
</html>
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2gulp__ui__docs.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">GUiLP</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md18"></a></p>
<p>Brief usage / porting guide</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Login and operation selection</h1>
<p>User is presented with a prompt asking the address of the gulp instance and credentials.</p>
<p><img src=".images/1.png" alt="1.png" class="inline"/></p>
<p>The actual stand-alone client also allows choosing a local session, i.e. without connecting to the backend (when it started as an internal tool it had basic processing features that have now been moved on server side). <code>/login</code></p>
<p>After logging in, an “Operation selection” window allows the user to choose the operation to work on (operation = investigation / incident). <code>/operation_list</code> If we will eventually decide to support different Elastic search indexes, a combined index/operation selection window should allow to choose index first, then list the operations for the selected index.</p>
<p><img src=".images/2.png" alt="2.png" class="inline"/></p>
<p>Once the operation has been selected, the client will list the saved sessions if any. In case there is no saved working session to restore, or the user wants to start a new one, the client will first interrogate the server in order to know the first and last event timestamp for the entire operation, and help the user decide an appropriate time window to work on (especially when the data on the server spans on multiple months or even years – the actual check is). This window is shown if the time span between the oldest and newest event is more 30 days.</p>
<p><code>/query_max_min</code></p>
<p>The range selection allows to choose between some presets (last day / week / month / full range) or manually specify the time range.</p>
<p><img src=".images/3.png" alt="3.png" class="inline"/></p>
<p>The next step is to choose which contexts/sources to use in a session, further in skimming the amount of data and thus narrow the focus.</p>
<p><img src=".images/4.png" alt="4.png" class="inline"/></p>
<p>In case the user has chosen to load a saved session, the saved time range and list of source will be just loaded from the saved session data.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Main window</h1>
<p>[IMAGE GOES HERE]</p>
<p>The main window is divided into 3 main areas: Context/source list, Events, Event details.</p>
<p>Some clarification about the lexicon: we use the word “source” to refer to a log source (e.g. a single log file on a system) and the word “context” to describe the system to which the source belongs (i.e. the system where the log originated)</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Context/source list</h2>
<p>A single source shows information such as the name of the log, the context it belongs to, the total number of events. It actually looks like this:</p>
<p><img src=".images/5.png" alt="5.png" class="inline"/></p>
<p>There’s plenty of space to add support to other additional information like custom tags and so on. The 6 menu items on the right allow to manually arrange the source, pin, hide/show it, set a custom filter or access an additional menu with further items such as undo last operation (last query), change rendering type, cancel any ongoing operation (i.e. query) for the currently selected source. The additional menu looks like this:</p>
<p><img src=".images/6.png" alt="6.png" class="inline"/></p>
<blockquote class="doxtable">
<p>&zwj;[!NOTE] We’re not yet sure if we want to keep things as they are, or arrange things in a sort of “tree” allowing to group sources belonging to the same context… suggestions or proposals are welcome. </p>
</blockquote>
<p>The source list is populated by calling <code>/query_operations</code> with token and index in the querystring, and then iterating the results, taking into account only those with the right operation_id. (@Valerio a more appropriate api for querying a single operation would be better).</p>
<p>Data in the response looks like this: </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;status&quot;: &quot;success&quot;,</div>
<div class="line">    &quot;timestamp_msec&quot;: 1720121934425,</div>
<div class="line">    &quot;req_id&quot;: &quot;faa1947f-78c7-4d5c-b016-e69155c6cba3&quot;,</div>
<div class="line">    &quot;data&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;Operation-name&quot;,</div>
<div class="line">            &quot;id&quot;: 1,</div>
<div class="line">            &quot;contexts&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;name&quot;: &quot;Context 1&quot;,</div>
<div class="line">                    &quot;doc_count&quot;: 457483,</div>
<div class="line">                    &quot;plugins&quot;: [</div>
<div class="line">                        {</div>
<div class="line">                            &quot;name&quot;: &quot;win_evtx&quot;,</div>
<div class="line">                            &quot;src_file&quot;: [</div>
<div class="line">                                {</div>
<div class="line">                                    &quot;name&quot;: &quot;Security.evtx&quot;,</div>
<div class="line">                                    &quot;doc_count&quot;: 202947,</div>
<div class="line">                                    &quot;max_event.code&quot;: 5061,</div>
<div class="line">                                    &quot;min_event.code&quot;: 4616,</div>
<div class="line">                                    &quot;min_@timestamp&quot;: 1717147858352,</div>
<div class="line">                                    &quot;max_@timestamp&quot;: 1717488873202</div>
<div class="line">                                },</div>
<div class="line">                                {</div>
<div class="line">                                    &quot;name&quot;: &quot;DNS Server.evtx&quot;,</div>
<div class="line">                                    &quot;doc_count&quot;: 92718,</div>
<div class="line">                                    &quot;max_event.code&quot;: 7693,</div>
<div class="line">                                    &quot;min_event.code&quot;: 2,</div>
<div class="line">                                    &quot;min_@timestamp&quot;: 1634218860636,</div>
<div class="line">                                    &quot;max_@timestamp&quot;: 1717487957421</div>
<div class="line">                                }</div>
<div class="line">                            ]</div>
<div class="line">                        }</div>
<div class="line">                    ]</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;name&quot;: &quot;Context 2&quot;,</div>
<div class="line">                    &quot;doc_count&quot;: 457483,</div>
<div class="line">                    &quot;plugins&quot;: [</div>
<div class="line">                        {</div>
<div class="line">                            &quot;name&quot;: &quot;apache_clf&quot;,</div>
<div class="line">                            &quot;src_file&quot;: [</div>
<div class="line">                                {</div>
<div class="line">                                    &quot;name&quot;: &quot;webserver.log&quot;,</div>
<div class="line">                                    &quot;doc_count&quot;: 23351,</div>
<div class="line">                                    &quot;max_event.code&quot;: 499,</div>
<div class="line">                                    &quot;min_event.code&quot;: 200,</div>
<div class="line">                                    &quot;min_@timestamp&quot;: 1693365081000,</div>
<div class="line">                                    &quot;max_@timestamp&quot;: 1693386812000</div>
<div class="line">                                }</div>
<div class="line">                            ]</div>
<div class="line">                        }</div>
<div class="line">                    ]</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Every context in the operation has a list of plugins (representing the ingestion plugin, and thus the type of events to be represented). For each plugin a list of source files is given, with the “local” max/min timestamps and max/min event codes (more info on this are found later in the document).</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Main event window</h2>
<p>The main part shows the events in each source. On the upper part a ruler shows the nearest time chunks, with variable tick values (depending on the zoom level) such as seconds, minutes, hours, days, months etc. Actual resolution gets as high as millisecond. Further evolution should take into account supporting nanosecond resolution.</p>
<p><img src=".images/7.png" alt="7.png" class="inline"/></p>
<p>The rest of the space is occupied by the events.</p>
<p><img src=".images/8.png" alt="8.png" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md23"></a>
General Metadata</h3>
<p>The violet full-height line on top of everything shows the timestamp corresponding to the mouse position in the window.</p>
<p><img src=".images/9.png" alt="9.png" class="inline"/></p>
<p>The yellow and orange vertical stripes (on the left and right bounds) mark the time frame originally selected by the user.</p>
<p><img src=".images/10.png" alt="10.png" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md24"></a>
Row Metadata</h3>
<p>The double green vertical lines in rows show the bounds for the single source, i.e. the timestamp corresponding to the first and last event present in the dataset on the backend. This is intended to be a metadata, shown also if the events are filtered out or are not in the selected timeframe. The height is a bit more than the row itself, so not to confuse this indicator with actual events. Next to this indicator, the total number of events (available) is shown in gray, while the amount of events actually on screen is shown in blue. This comes handy to see whether data is being filtered, and how many events are shown by the selected filter.</p>
<p><img src=".images/11.png" alt="11.png" class="inline"/></p>
<p>Another indicator is a dashed line at the center of the row, when such a line is shown it means that the row is still receiving data from the back-end.</p>
<p><img src=".images/12.png" alt="12.png" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md25"></a>
Row data</h3>
<p>Each row shows the events and notes for the corresponding source. On a row both events and notes can be displayed: events are drawn in full height, while notes are actually drawn only in the upper half.</p>
<p><img src=".images/13.png" alt="13.png" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md26"></a>
Events</h3>
<p>Events for each row are retrieved using <code>/query_gulp</code> with a GulpQueryFilter to match the right src/context and a GulpQueryOptions object to ask for results in descending order (we are usually interested in newer events first):</p><ul>
<li>GulpQueryFilter → start = session_mintime, end = session_maxtime, operationId = operationi,; context = current_context, srcfile = current_sourcefile.</li>
<li>GulpQueryOptions → sort = "@timestamp", "desc"</li>
</ul>
<p>The response has a “CollabStats” object (whose name is misleading and should be changed soon) with a list of events with basic properties in the “query_results” array: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;status&quot;: &quot;success&quot;,</div>
<div class="line">  &quot;data&quot;: {</div>
<div class="line">    &quot;id&quot;: null,</div>
<div class="line">    &quot;type&quot;: 6,</div>
<div class="line">    &quot;req_id&quot;: &quot;639432bd-db7f-4a7f-a226-400a77af4c92&quot;,</div>
<div class="line">    &quot;operation_id&quot;: null,</div>
<div class="line">    &quot;client_id&quot;: null,</div>
<div class="line">    &quot;context&quot;: null,</div>
<div class="line">    &quot;status&quot;: 1,</div>
<div class="line">    &quot;time_created&quot;: 1720124695866,</div>
<div class="line">    &quot;time_expire&quot;: 0,</div>
<div class="line">    &quot;time_update&quot;: 0,</div>
<div class="line">    &quot;time_end&quot;: 1720124696005,</div>
<div class="line">    &quot;ev_failed&quot;: 0,</div>
<div class="line">    &quot;ev_skipped&quot;: 0,</div>
<div class="line">    &quot;ev_processed&quot;: 0,</div>
<div class="line">    &quot;files_processed&quot;: 0,</div>
<div class="line">    &quot;files_total&quot;: 0,</div>
<div class="line">    &quot;queries_total&quot;: 1,</div>
<div class="line">    &quot;sigma_group_results&quot;: null,</div>
<div class="line">    &quot;query_results&quot;: [</div>
<div class="line">      {</div>
<div class="line">        &quot;events&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;operation_id&quot;: 6,</div>
<div class="line">            &quot;@timestamp&quot;: 1717147409839,</div>
<div class="line">            &quot;source.domain&quot;: &quot;test_uploader_context&quot;,</div>
<div class="line">            &quot;log.file.path&quot;: &quot;Security.evtx&quot;,</div>
<div class="line">            &quot;event.code&quot;: &quot;4797&quot;,</div>
<div class="line">            &quot;event.duration&quot;: 0,</div>
<div class="line">            &quot;_id&quot;: &quot;8c15b46dc6f5259a92d4dad911b737ed529f7f4fe5330b79255863e048b0fc6e46b603694dee987aa64193a774f8dec33f36e72dcb02a667a2a7cf3b29b0a7b9&quot;</div>
<div class="line">          },</div>
<div class="line">          {</div>
<div class="line">            &quot;operation_id&quot;: 6,</div>
<div class="line">            &quot;@timestamp&quot;: 1717147409834,</div>
<div class="line">            &quot;source.domain&quot;: &quot;test_uploader_context&quot;,</div>
<div class="line">            &quot;log.file.path&quot;: &quot;Security.evtx&quot;,</div>
<div class="line">            &quot;event.code&quot;: &quot;4797&quot;,</div>
<div class="line">            &quot;event.duration&quot;: 0,</div>
<div class="line">            &quot;_id&quot;: &quot;1193047aacd499d1cece1fc2122c7e2ff2a39916006e694abe349e04e5b9a4ad9ff6bc7a964f4cfe74e1c00149f43aebe9dc00c67280e6db11cd0159e7cdb08e&quot;</div>
<div class="line">          },</div>
<div class="line">          {</div>
<div class="line">            &quot;operation_id&quot;: 6,</div>
<div class="line">            &quot;@timestamp&quot;: 1717147409820,</div>
<div class="line">            &quot;source.domain&quot;: &quot;test_uploader_context&quot;,</div>
<div class="line">            &quot;log.file.path&quot;: &quot;Security.evtx&quot;,</div>
<div class="line">            &quot;event.code&quot;: &quot;4797&quot;,</div>
<div class="line">            &quot;event.duration&quot;: 0,</div>
<div class="line">            &quot;_id&quot;: &quot;82322ecd3f4a25f9a40b2d020178530de7900735b03294e8b30ca196a5909fe18994c874e44fbd9a80a7547172b1f4f35d840509997c3bef2dcf66a57327c095&quot;</div>
<div class="line">          }</div>
<div class="line">        ],</div>
<div class="line">        &quot;aggregations&quot;: null,</div>
<div class="line">        &quot;total_hits&quot;: 9037,</div>
<div class="line">        &quot;search_after&quot;: [</div>
<div class="line">  1717419026242, &quot;d0e7a4fac93fcbf728c2e352248a2bf76821c3449e8ab93b0e64f7146e7a288947635bb3b8ff814e6e139a4ee5a23b53efb8688566252adf5a90dd6be47f70fe&quot;</div>
<div class="line">],</div>
<div class="line">        &quot;query_glyph_id&quot;: null,</div>
<div class="line">        &quot;error&quot;: null,</div>
<div class="line">        &quot;sigma_rule_file&quot;: null,</div>
<div class="line">        &quot;sigma_rule_id&quot;: null,</div>
<div class="line">        &quot;stored_query_id&quot;: null,</div>
<div class="line">        &quot;query_dsl&quot;: null,</div>
<div class="line">        &quot;query_name&quot;: &quot;gulpfilter-ce9da5bb-9309-4a6e-9724-86b959ba311d&quot;</div>
<div class="line">      }</div>
<div class="line">    ],</div>
<div class="line">    &quot;live&quot;: false,</div>
<div class="line">    &quot;matched_events_total&quot;: 9037,</div>
<div class="line">    &quot;ingest_errors&quot;: null,</div>
<div class="line">    &quot;current_src_file&quot;: null</div>
<div class="line">  },</div>
<div class="line">  &quot;reqId&quot;: &quot;639432bd-db7f-4a7f-a226-400a77af4c92&quot;,</div>
<div class="line">  &quot;timestamp&quot;: &quot;2024-07-04T20:24:56.006Z&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The basic data for each event allows to correctly insert it into the right container (context name, source name) and draw it (timestamp and event code). Note: The naming here is a bit different because we’re adhering to ECS mapping for compatibility: context=source.domain and sourcefile=log.file.path</p>
<h4><a class="anchor" id="autotoc_md27"></a>
Paging results</h4>
<p>GulpQueryFilter has a default limit of 1000 results per query (the amount can be changed in the request), when more results are available, the “search_after” property is populated with the next timestamp and event id to be used for the next request (i.e. to retrieve the next “page” of results – just use the same search_after in the response). The fetching loop ends when the “search_after” object in the response is null, that is, when there are no more results.</p>
<h4><a class="anchor" id="autotoc_md28"></a>
Drawing events</h4>
<p>Events are drawn based on their basic properties: @timestamp, event.duration and event.code. The first two allow to “place” the event on the timeline, while the latter determines the event’s color.</p>
<p>Thanks to the local max and min event codes for each source, we can apply a linear interpolation to map the event code to a color in a fixed-size gradient array. At the moment the only used palette is FLIR’s “ironbow”, and some others have been set up (matplotlib’s Viridis, Stragma, etc). In the future, users should be able to configure each source’s palette, as well as use their own gradients.</p>
<p>Depending on the type of the event, that is the type of the sourcefile, a different render can be used. Currently 3 type specific renderers are available, namely win_evtx (windows evtx events) apache_clf (common log format) and a generic event renderer (similar to win_evtx with no gradient). Two more example generic purpose renderers are histogram and plot, whose main function is to give an idea of the density of events across time chunks. The actual implementation is just demonstrative and should be reviewed. </p><blockquote class="doxtable">
<p>&zwj;[!NOTE] The actual desktop client can be extended with additional custom rendering plugins, and we were imagining a custom simple DSL in the future to allow non programmers making their own rendering plugins. Take this into consideration when designing the code architecture of the web client (the DSL could be overkill, maybe just a simple js interface with drawing primitives?) </p>
</blockquote>
<p><img src=".images/14.png" alt="14.png" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md29"></a>
Notes, links and other collaboration objects</h3>
<p>Similarly to events, the following collabobjects can be retrieved: Notes → main properties are: title, description, glyph (icon) and a timepin (if a note is not related to any event) or a list of related events. When a note has multiple related events, it should be shown along each event it refers to. A color attribute is also available, originally used to dye icon as a further mean of color coding notes (up to the). <code>/note_list</code> Links → main properties are: one source event, one or more target events <code>/link_list</code> Highligths → …</p>
<blockquote class="doxtable">
<p>&zwj;[!NOTE] collabobj apis should be adapted to match the event api behaviour, adding the possibility of querying a defined time range and retrieving a minimal subset of information. </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md30"></a>
Event / note details</h3>
<p>When clicking on an event or note, the corresponding details are shown in the rightmost area of the screen. Event details in the upper box, note details in the lower.</p>
<p>TODO: -let the user switch between the raw text and the json tree representation</p>
<p>Api: <code>/query_single_event</code> ( possibily /query_single_note when it will be added)</p>
<p><img src=".images/15.png" alt="15.png" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md31"></a>
Using the main view</h1>
<p>This view can be panned (moved) by left clicking and dragging the mouse around, and zoomed using the mouse wheel or right clicking to draw a zoom area. A sort of magnifying glass to aid clicking on thin events can be brought up by pressing the shift key while the mouse cursor is in the main event area.</p>
<p><img src=".images/16.png" alt="16.png" class="inline"/></p>
<p>It is also possible to quickly go to the next or previous event, relative to the currently selected one, by pressing the A and D keys, respectively.</p>
<p>Finally, a large menu bar at the bottom hosts buttons related to:</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Session menu</h2>
<p><img src=".images/17.png" alt="17.png" class="inline"/></p><ul>
<li>Clear session → clears everything (not sure it’s currently useful, it was in the legacy stand-alone version)</li>
<li>Load session → load a previously saved session (working in the legacy version, needs to be converted using the web api, using the “session” collabobject)</li>
<li>Save session → same as above</li>
<li>Show/hide links</li>
<li>Swap light/dark theme</li>
<li>Upload file → allows uploading new files to be ingested by the backend or sigma rules to be applied to the events.</li>
<li>Save current screen – exports the currently shown screen to an image</li>
<li>Export to svg – exports the currently shown sources to an svg file, if supported by the source type renderer. Most svg rendering functions are not up to date with the screen rendering counterparts.</li>
<li>Debug menu - shows a debug menu (internal use only)</li>
<li>Refresh data – reloads all data from the server</li>
</ul>
<h2><a class="anchor" id="autotoc_md33"></a>
Timeview menu</h2>
<p><img src=".images/18.png" alt="18.png" class="inline"/></p><ul>
<li>“Zoom fit” → zooms out as far as possible to fit all events (in the current session) into the window</li>
<li>Select new range → shows the range selection window (just like at the beginning of the session)</li>
<li>Zoom → allows to zoom on a specified area (same as right-clicking)</li>
<li>Go to time → ask the user for a timestamp and center it on the screen</li>
<li>Add / delete row → manually add or delete a source track (not used anymore – can be removed?)</li>
<li>Highlight → draws an highlighted area (this is not used at the moment, and should be mapped to a collab object named “highlight”)</li>
<li>Manually draw link → this feature is not used anymore, links should be created through the event/note menu.</li>
</ul>
<h2><a class="anchor" id="autotoc_md34"></a>
Event/note menu:</h2>
<p><img src=".images/19.png" alt="19.png" class="inline"/></p><ul>
<li>Add / edit note → Adds a new note to the selected event, or edit an existing one</li>
<li>Go to event → when a note is clicked, go to the corresponding event (This is now deprecated, as both the event and the note are shown, vertically stacked, in the leftmost area)</li>
<li>Delete note → no explanation needed</li>
<li>Delete event → manually delete an nevent (not used anymore -should be removed?)</li>
<li>Set link start → marks the currently selected event as the start of a link</li>
<li>Set link end → marks the currently selected event as the end of a link (when both the start and end points are selected, a new link is created)</li>
<li>Show note list – shows the list of available notes.</li>
</ul>
<h2><a class="anchor" id="autotoc_md35"></a>
Adding a note</h2>
<p><img src=".images/20.png" alt="20.png" class="inline"/></p>
<p>Api <code>/note_create</code></p>
<h2><a class="anchor" id="autotoc_md36"></a>
Uploading a file</h2>
<p><img src=".images/21.png" alt="21.png" class="inline"/></p>
<p>The file upload window allow the user to upload new files to be ingested or rules to be processed. Currently the file format is lamely guessed by its extension.</p>
<p>Api <code>/ingest_file</code></p>
<h3><a class="anchor" id="autotoc_md37"></a>
TODO:</h3>
<ul>
<li>Format identification should be thoroughly implemented on the client or server side, as it impacts on how the file will be ingested (i.e. the appropriate ingestion plugin that should be used). Users should be able to override the ingestion plugin used regardless of the identified format.</li>
<li>The user should specify the context for which the file is being ingested, and possibly be able to override the name! If a file .zip is provided and contains a file named “manifest.json” in the root of the archive, it should be treated as a special “format” and the included manifest file should be used to identify the format of each file in the archive instead. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script>
    mermaid.initialize({
        startOnLoad: true,
        theme: "dark",
    });
</script>
