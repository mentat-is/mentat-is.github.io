<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <meta name="generator" content="Doxygen 1.12.0" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- BEGIN opengraph metadata -->
        <meta property="og:title" content="gULP! Documentation" />
        <meta
            property="og:image"
            content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452"
        />
        <meta
            property="og:description"
            content="Custom CSS theme for doxygen html-documentation with lots of customization parameters."
        />
        <meta
            property="og:url"
            content="https://github.com/rcskunkworks/gulp"
        />
        <!-- END opengraph metadata -->
        <!-- BEGIN twitter metadata -->
        <meta
            name="twitter:image:src"
            content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452"
        />
        <meta name="twitter:title" content="Mentat" />
        <meta name="twitter:description" content="mentat.is" />
        <!-- END twitter metadata -->
        <title>(g)ULP!: src/gulp/plugin.py Source File</title>
        <link href="tabs.css" rel="stylesheet" type="text/css" />
        <link rel="icon" type="image/svg+xml" href="logo.drawio.svg" />
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="dynsections.js"></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-darkmode-toggle.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-fragment-copy-button.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-paragraph-link.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-interactive-toc.js"
        ></script>
        <script
            type="text/javascript"
            src="doxygen-awesome-tabs.js"
        ></script>
        <script type="text/javascript">
            DoxygenAwesomeFragmentCopyButton.init();
            DoxygenAwesomeDarkModeToggle.init();
            DoxygenAwesomeParagraphLink.init();
            DoxygenAwesomeInteractiveToc.init();
            DoxygenAwesomeTabs.init();
        </script>
        </script>
        <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <script src="https://cdn.jsdelivr.net/npm/mermaid@latest/dist/mermaid.min.js"></script>
        <a
            href="https://github.com/rcskunkworks/gulp"
            class="github-corner"
            title="View source on GitHub"
            target="_blank"
            rel="noopener noreferrer"
        >
            <svg
                viewBox="0 0 250 250"
                width="40"
                height="40"
                style="
                    position: absolute;
                    top: 0;
                    border: 0;
                    right: 0;
                    z-index: 99;
                "
                aria-hidden="true"
            >
                <path
                    d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"
                ></path>
                <path
                    d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                    fill="currentColor"
                    style="transform-origin: 130px 106px"
                    class="octo-arm"
                ></path>
                <path
                    d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                    fill="currentColor"
                    class="octo-body"
                ></path></svg
        ></a>
        <style>
            .github-corner:hover .octo-arm {
                animation: octocat-wave 560ms ease-in-out;
            }
            @keyframes octocat-wave {
                0%,
                100% {
                    transform: rotate(0);
                }
                20%,
                60% {
                    transform: rotate(-25deg);
                }
                40%,
                80% {
                    transform: rotate(10deg);
                }
            }
            @media (max-width: 500px) {
                .github-corner:hover .octo-arm {
                    animation: none;
                }
                .github-corner .octo-arm {
                    animation: octocat-wave 560ms ease-in-out;
                }
            }
        </style>
        <div id="top">
            <!-- do not remove this div, it is closed by doxygen! -->
            <div id="titlearea">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr style="height: 56px">
                            <td id="projectalign" style="padding-left: 0.5em">
                                <div id="projectname">
                                    (g)ULP!
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- end header part -->
        </div>
    </body>
</html>
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('plugin_8py_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">plugin.py</div></div>
</div><!--header-->
<div class="contents">
<a href="plugin_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespacegulp.html">    1</a></span><span class="stringliteral">&quot;&quot;&quot;Gulp plugin base class and plugin utilities.</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">import</span> ipaddress</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">import</span> logging</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">import</span> os</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="keyword">from</span> types <span class="keyword">import</span> ModuleType</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="keyword">from</span> typing <span class="keyword">import</span> Any, Callable</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="keyword">import</span> muty.crypto</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="keyword">import</span> muty.dynload</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="keyword">import</span> muty.file</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="keyword">import</span> muty.jsend</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="keyword">import</span> muty.string</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="keyword">import</span> muty.time</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="keyword">from</span> opensearchpy <span class="keyword">import</span> AsyncOpenSearch <span class="keyword">as</span> AsyncElasticsearch</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="keyword">from</span> sigma.processing.pipeline <span class="keyword">import</span> ProcessingPipeline</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="keyword">from</span> sqlalchemy.ext.asyncio <span class="keyword">import</span> AsyncEngine</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="keyword">import</span> gulp.api.elastic_api <span class="keyword">as</span> elastic_api</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="keyword">import</span> gulp.api.mapping.helpers <span class="keyword">as</span> mappings_helper</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="keyword">import</span> gulp.api.rest.ws <span class="keyword">as</span> ws_api</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="keyword">import</span> gulp.config <span class="keyword">as</span> config</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keyword">import</span> gulp.utils <span class="keyword">as</span> gulp_utils</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="keyword">from</span> gulp.api.collab.base <span class="keyword">import</span> GulpRequestStatus</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="keyword">from</span> gulp.api.collab.stats <span class="keyword">import</span> GulpStats, TmpIngestStats</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="keyword">from</span> gulp.api.elastic.structs <span class="keyword">import</span> GulpDocument, GulpIngestionFilter</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keyword">from</span> gulp.api.mapping.models <span class="keyword">import</span> FieldMappingEntry, GulpMapping, GulpMappingOptions</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="keyword">from</span> gulp.api.rest.ws <span class="keyword">import</span> WsQueueDataType</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="keyword">from</span> gulp.defs <span class="keyword">import</span> (</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    GulpEventFilterResult,</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    GulpLogLevel,</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    GulpPluginType,</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    InvalidArgument,</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    ObjectNotFound,</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>)</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacegulp_1_1plugin__internal.html">gulp.plugin_internal</a> <span class="keyword">import</span> GulpPluginOption, GulpPluginParams</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a2ddd134f01ffaf4a48113569d98fd962">   41</a></span>_logger: logging.Logger = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="comment"># caches plugin modules for the running process</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a928d8794fba69c8e585a9de2d20d5465">   44</a></span>_cache: dict = {}</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="foldopen" id="foldopen00047" data-start="" data-end="">
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a0b74780046e4ade35e214c7f2926d02c">   47</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a0b74780046e4ade35e214c7f2926d02c">init</a>(logger: logging.Logger):</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="stringliteral">    Initializes the plugin base module.</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="keyword">global</span> _logger</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    _logger = logger</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
</div>
<div class="foldopen" id="foldopen00055" data-start="" data-end="">
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html">   55</a></span><span class="keyword">class </span><a class="code hl_class" href="classgulp_1_1plugin_1_1_plugin_base.html">PluginBase</a>(ABC):</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="stringliteral">    Base class for all Gulp plugins.</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="foldopen" id="foldopen00060" data-start="" data-end="">
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ad7e45821be80096c2a8b7c47f7ac1eed">   60</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ad7e45821be80096c2a8b7c47f7ac1eed">__init__</a>(</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        self,</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>        path: str,</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        collab: AsyncEngine = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>        elastic: AsyncElasticsearch = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        **kwargs,</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    ) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="stringliteral">        Initializes a new instance of the PluginBase class.</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="stringliteral">            path (str): The path to the plugin.</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="stringliteral">            collab: instance of sqlalchemy client</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="stringliteral">            elastic: instance of elasticsearch client</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="stringliteral">            kwargs: additional arguments if any</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a1370c514cd93cb996ddf27f0400840bc">   76</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a1370c514cd93cb996ddf27f0400840bc">req_id</a>: str = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a0d326931fdde686f05f73ed00cad6f36">   77</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a0d326931fdde686f05f73ed00cad6f36">index</a>: str = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a12087c1690a56089011c8e1a9f4e319e">   78</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a12087c1690a56089011c8e1a9f4e319e">client_id</a>: str = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ad1f1eb15a79c7b61e759632d9333976b">   79</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#ad1f1eb15a79c7b61e759632d9333976b">operation_id</a>: str = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#aed88676be607a3199e7b417512f3d8f1">   80</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#aed88676be607a3199e7b417512f3d8f1">context</a>: str = (<span class="keywordtype">None</span>,)</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a333f06e1a7df05effecbc6a8fa238cca">   81</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a333f06e1a7df05effecbc6a8fa238cca">ws_id</a>: str = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#aa28dc103258589d9cb421197fe2de90b">   82</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#aa28dc103258589d9cb421197fe2de90b">path</a> = path</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#af2760b1eea7c1b7f2459abf2872cbac6">   83</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#af2760b1eea7c1b7f2459abf2872cbac6">collab</a> = collab</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a85ca465c1498add707b193266a2dc717">   84</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a85ca465c1498add707b193266a2dc717">elastic</a> = elastic</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">   86</a></span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">buffer</a>: list[GulpDocument] = []</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>        <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> kwargs.items():</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            self.__dict__[k] = v</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        <span class="comment"># initialize mapping helper</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>        mappings_helper.init(_logger)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        super().<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ad7e45821be80096c2a8b7c47f7ac1eed">__init__</a>()</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="preprocessor">@classmethod</span></div>
<div class="foldopen" id="foldopen00095" data-start="" data-end="">
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">   95</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>(cls) -&gt; logging.Logger:</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>        <span class="keyword">global</span> _logger</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>        <span class="keywordflow">return</span> _logger</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
</div>
<div class="foldopen" id="foldopen00099" data-start="" data-end="">
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ae7a969999e7d7be46f79b575de5f2224">   99</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ae7a969999e7d7be46f79b575de5f2224">options</a>(self) -&gt; list[GulpPluginOption]:</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="stringliteral">        return available GulpPluginOption list (plugin specific parameters)</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>        <span class="keywordflow">return</span> []</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span> </div>
</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <span class="preprocessor">@abstractmethod</span></div>
<div class="foldopen" id="foldopen00106" data-start="" data-end="">
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a48d7d6a080b67ba8c58522a1e05ce930">  106</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a48d7d6a080b67ba8c58522a1e05ce930">type</a>(self) -&gt; GulpPluginType:</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="stringliteral">        Returns the plugin type.</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="preprocessor">@abstractmethod</span></div>
<div class="foldopen" id="foldopen00112" data-start="" data-end="">
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a1e436b61f937ea687fa3897d286899cf">  112</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a1e436b61f937ea687fa3897d286899cf">version</a>(self) -&gt; str:</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="stringliteral">        Returns plugin version.</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <span class="preprocessor">@abstractmethod</span></div>
<div class="foldopen" id="foldopen00118" data-start="" data-end="">
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ad23a45a663b1933199b70ae3631e451b">  118</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ad23a45a663b1933199b70ae3631e451b">desc</a>(self) -&gt; str:</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="stringliteral">        Returns a description of the plugin.</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span> </div>
</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="preprocessor">@abstractmethod</span></div>
<div class="foldopen" id="foldopen00124" data-start="" data-end="">
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a3cc5beb95fb74f4be44c04f84ed66a82">  124</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a3cc5beb95fb74f4be44c04f84ed66a82">name</a>(self) -&gt; str:</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="stringliteral">        Returns the name of the plugin.</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
</div>
<div class="foldopen" id="foldopen00129" data-start="" data-end="">
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ad79ad6ef42363d02816e4b70b1c56fb5">  129</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ad79ad6ef42363d02816e4b70b1c56fb5">event_type_field</a>(self) -&gt; str:</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="stringliteral">        Returns the field name for the event type.</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;event.code&quot;</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
</div>
<div class="foldopen" id="foldopen00135" data-start="" data-end="">
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a01add25e2c2397d9ed56eca11d4105c0">  135</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a01add25e2c2397d9ed56eca11d4105c0">depends_on</a>(self) -&gt; list[str]:</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="stringliteral">        Returns a list of plugins this plugin depends on.</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>        <span class="keywordflow">return</span> []</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
</div>
<div class="foldopen" id="foldopen00141" data-start="" data-end="">
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a0373c98260b243f699a1e65849b1fcad">  141</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a0373c98260b243f699a1e65849b1fcad">run_command</a>(self, p: GulpPluginParams) -&gt; dict:</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="stringliteral">        Runs a custom command</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
</div>
<div class="foldopen" id="foldopen00147" data-start="" data-end="">
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ac6a9f9fea14049c9afb7094bb617363f">  147</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ac6a9f9fea14049c9afb7094bb617363f">internal</a>(self) -&gt; bool:</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span><span class="stringliteral">        Returns whether the plugin is for internal use only</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>        <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
</div>
<div class="foldopen" id="foldopen00153" data-start="" data-end="">
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#acc17a69ceae0067ad2cc9bba5fe59fe9">  153</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#acc17a69ceae0067ad2cc9bba5fe59fe9">tags</a>(self) -&gt; list[str]:</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="stringliteral">        returns a list of tags for the plugin. Tags are used to aid filtering of plugins/query filters in the UI.</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="stringliteral">        - &quot;event&quot;</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="stringliteral">        - &quot;network&quot;</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="stringliteral">        - &quot;file&quot;</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="stringliteral">        - &quot;process&quot;</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="stringliteral">        - &quot;threat&quot;</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span><span class="stringliteral">        - &quot;threat.enrichments&quot;</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="stringliteral">        - ...</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="keywordflow">return</span> []</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
</div>
<div class="foldopen" id="foldopen00166" data-start="" data-end="">
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ac39f95b7470b242061ba67ee749c4b44">  166</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ac39f95b7470b242061ba67ee749c4b44">_process_plugin_params</a>(</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        self, custom_mapping: GulpMapping, plugin_params: GulpPluginParams = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    ) -&gt; tuple[GulpMapping, GulpPluginParams]:</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="stringliteral">        Process the plugin parameters checking parameters as `timestamp_field`, ... and update the custom mapping accordingly.</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="stringliteral">            custom_mapping (GulpMapping): The custom mapping provided: if it is not empty, it will be used as is (plugin_params will be ignored)</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="stringliteral">            plugin_params (GulpPluginParams, optional): The plugin parameters. Defaults to None.</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span><span class="stringliteral">            tuple[GulpMapping, GulpPluginParams]: The updated custom mapping and plugin parameters.</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <span class="keywordflow">if</span> plugin_params <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>            plugin_params = <a class="code hl_class" href="classgulp_1_1plugin__internal_1_1_gulp_plugin_params.html">GulpPluginParams</a>()</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        <span class="keywordflow">if</span> len(custom_mapping.fields) &gt; 0:</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>            <span class="comment"># custom_mapping provided</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            <span class="keywordflow">return</span> custom_mapping, plugin_params</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>().warning(<span class="stringliteral">&quot;no custom mapping provided&quot;</span>)</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>        tf = plugin_params.timestamp_field</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>        <span class="keywordflow">if</span> tf <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>            self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>().debug(<span class="stringliteral">&quot;using timestamp_field=%s&quot;</span> % (tf))</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>            <span class="comment"># build a proper custom_mapping with just timestamp</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>            custom_mapping.fields[tf] = FieldMappingEntry(is_timestamp=<span class="keyword">True</span>)</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <span class="comment"># self.logger().debug(custom_mapping)</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        <span class="keywordflow">return</span> custom_mapping, plugin_params</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span> </div>
</div>
<div class="foldopen" id="foldopen00196" data-start="" data-end="">
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a0e422abddcbb67f93856a6f754cbfef7">  196</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a0e422abddcbb67f93856a6f754cbfef7">sigma_plugin_initialize</a>(</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        self,</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        pipeline: ProcessingPipeline = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        mapping_file: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        mapping_id: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        product: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        plugin_params: GulpPluginParams = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    ) -&gt; ProcessingPipeline:</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="stringliteral">        Initializes the Sigma plugin to convert sigma rules YAML to elasticsearch DSL query.</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="stringliteral">            pipeline (ProcessingPipeline, optional): The processing pipeline. Defaults to None (empty pipeline, plugin must fill it).</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="stringliteral">            mapping_file (str, optional): The name of the mapping file (i.e. &#39;windows.json&#39;) in the gulp/mapping_files directory. Defaults to None (use pipeline mapping only).</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="stringliteral">            mapping_id (str, optional): The mapping ID ([&quot;options&quot;][&quot;mapping_id&quot;] in the mapping file, to get a specific mapping). Defaults to None (use first).</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="stringliteral">            product (str, optional): The product. Defaults to None.</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="stringliteral">            plugin_params (GulpPluginParams, optional): The plugin parameters, to override i.e. mapping_file_path, mapping_id, ... Defaults to None.</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="stringliteral">            ProcessingPipeline: The initialized processing pipeline.</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>().debug(<span class="stringliteral">&quot;INITIALIZING SIGMA plugin=%s&quot;</span> % (self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a3cc5beb95fb74f4be44c04f84ed66a82">name</a>()))</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        mapping_file_path = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        <span class="keywordflow">if</span> mapping_file <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            <span class="comment"># get path in mapping directory</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            mapping_file_path = gulp_utils.build_mapping_file_path(mapping_file)</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>        <span class="keywordflow">if</span> plugin_params <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>            <span class="comment"># override with plugin_params</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            <span class="keywordflow">if</span> plugin_params.mapping_file <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>                mapping_file_path = gulp_utils.build_mapping_file_path(</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                    plugin_params.mapping_file</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                )</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            <span class="keywordflow">if</span> plugin_params.mapping_id <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>                mapping_id = plugin_params.mapping_id</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        p = await mappings_helper.get_enriched_pipeline(</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            pipeline=pipeline,</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            mapping_file_path=mapping_file_path,</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            mapping_id=mapping_id,</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>            product=product,</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        )</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <span class="keywordflow">return</span> p</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
</div>
<div class="foldopen" id="foldopen00240" data-start="" data-end="">
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#abf39f32a2e7e60975eac7054393625da">  240</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#abf39f32a2e7e60975eac7054393625da">_process_record</a>(</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        self,</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        index: str,</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        record: any,</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        record_idx: int,</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        my_record_to_gulp_document_fun: Callable,</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        ws_id: str,</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        req_id: str,</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        operation_id: int,</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        client_id: int,</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        context: str,</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        source: str,</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        fs: TmpIngestStats,</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>        custom_mapping: GulpMapping = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        index_type_mapping: dict = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        plugin: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        plugin_params: GulpPluginParams = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        flt: GulpIngestionFilter = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>        **kwargs,</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    ) -&gt; tuple[TmpIngestStats, bool]:</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span><span class="stringliteral">        Process a record for ingestion, updating ingestion stats.</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span><span class="stringliteral">            index (str): The index to ingest the record into.</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span><span class="stringliteral">            record (any): The record to process.</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span><span class="stringliteral">            record_idx (int): The index of the record as in the source.</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span><span class="stringliteral">            my_record_to_gulp_document_fun (Callable): The function (for this plugin) to convert the record to one or more GulpDocument/s.</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span><span class="stringliteral">            ws_id (str): The websocket ID</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span><span class="stringliteral">            req_id (str): The request ID.</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="stringliteral">            operation_id (int): The operation ID.</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="stringliteral">            client_id (int): The client ID.</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="stringliteral">            context (str): The context of the record.</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span><span class="stringliteral">            source (str): The source of the record.</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span><span class="stringliteral">            fs (TmpIngestStats): The temporary ingestion statistics.</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="stringliteral">            custom_mapping (GulpMapping, optional): The custom mapping for the record. Defaults to None.</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span><span class="stringliteral">            index_type_mapping (dict, optional): The elastic index type mapping. Defaults to None.</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span><span class="stringliteral">            plugin (str, optional): The plugin name. Defaults to None.</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="stringliteral">            plugin_params (GulpPluginParams, optional): The plugin parameters. Defaults to None.</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span><span class="stringliteral">            flt (GulpIngestionFilter, optional): The ingestion filter. Defaults to None.</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span><span class="stringliteral">            **kwargs: Additional keyword arguments.</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="stringliteral">            tuple[TmpIngestStats, bool]: A tuple containing the updated temporary ingestion statistics and a flag indicating whether to break the ingestion process.</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        <span class="comment"># convert record to one or more GulpDocument objects</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>        docs = await self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a381f36429810987d7e1a4603c3f4dfea">_call_record_to_gulp_document_funcs</a>(</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>            operation_id=operation_id,</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>            client_id=client_id,</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>            context=context,</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            source=source,</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            fs=fs,</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>            record=record,</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            record_idx=record_idx,</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>            custom_mapping=custom_mapping,</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>            index_type_mapping=index_type_mapping,</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            plugin=plugin,</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>            plugin_params=plugin_params,</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            record_to_gulp_document_fun=my_record_to_gulp_document_fun,</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>            **kwargs,</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        )</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        <span class="comment"># ingest record</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>        <span class="keywordflow">for</span> d <span class="keywordflow">in</span> docs:</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            fs = await self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ad9cf9630b6d3e7ae9eab1b880e786222">_ingest_record</a>(index, d, fs, ws_id, req_id, flt, **kwargs)</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        status, _ = await GulpStats.update(</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#af2760b1eea7c1b7f2459abf2872cbac6">collab</a>,</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>            req_id,</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            ws_id,</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            fs=fs.update(processed=len(docs)),</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        )</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        must_break = <span class="keyword">False</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        <span class="keywordflow">if</span> status <span class="keywordflow">in</span> [GulpRequestStatus.FAILED, GulpRequestStatus.CANCELED]:</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>            must_break = <span class="keyword">True</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>        <span class="keywordflow">return</span> fs, must_break</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> </div>
</div>
<div class="foldopen" id="foldopen00316" data-start="" data-end="">
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a66de2da998fe4b3958a3a6ce1189fbe8">  316</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a66de2da998fe4b3958a3a6ce1189fbe8">ingest_plugin_initialize</a>(</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>        self,</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>        index: str,</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        source: str | dict,</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        skip_mapping: bool = <span class="keyword">False</span>,</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        pipeline: ProcessingPipeline = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>        mapping_file: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>        mapping_id: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>        plugin_params: GulpPluginParams = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    ) -&gt; tuple[dict, GulpMapping]:</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span><span class="stringliteral">        Initializes the ingestion plugin.</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="stringliteral">            index (str): The name of the elasticsearch index.</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="stringliteral">            source (str|dict): The source of the record (source file name or path, usually. may also be a dictionary.).</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="stringliteral">            skip_mapping (bool, optional): Whether to skip mapping initialization (just prints source and plugin name, and return empty index mapping and custom mapping). Defaults to False.</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span><span class="stringliteral">            pipeline (ProcessingPipeline, optional): The psyigma pipeline to borrow the mapping from, if any. Defaults to None (use mapping file only).</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="stringliteral">            mapping_file (str, optional): name of the mapping file (i.e. &#39;windows.json&#39;) in the gulp/mapping_files directory. Defaults to None (use pipeline mapping only).</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span><span class="stringliteral">            mapping_id (str, optional): The mapping ID (options.mapping_id) in the mapping file, to get a specific mapping. Defaults to None (use first).</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span><span class="stringliteral">            plugin_params (GulpPluginParams, optional): The plugin parameters (i.e. to override mapping_file, mapping_id, ...). Defaults to None.</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="stringliteral">            tuple[dict, GulpMapping]: A tuple containing the elasticsearch index type mappings and the enriched GulpMapping (or an empty GulpMapping is no valid pipeline and/or mapping_file are provided).</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        <span class="comment"># self.logger().debug(&quot;ingest_plugin_initialize: index=%s, pipeline=%s, mapping_file=%s, mapping_id=%s, plugin_params=%s&quot; % (index, pipeline, mapping_file, mapping_id, plugin_params))</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>        self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>().debug(</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>            <span class="stringliteral">&quot;INITIALIZING INGESTION for source=%s, plugin=%s&quot;</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            % (muty.string.make_shorter(source, 260), self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a3cc5beb95fb74f4be44c04f84ed66a82">name</a>())</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        )</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>        <span class="keywordflow">if</span> skip_mapping:</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>            <span class="keywordflow">return</span> {}, GulpMapping()</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>        <span class="comment"># get path of the mapping file in gulp/mapping_files folder</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        mapping_file_path = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        <span class="keywordflow">if</span> mapping_file <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>            mapping_file_path = gulp_utils.build_mapping_file_path(mapping_file)</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        <span class="keywordflow">if</span> plugin_params <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>            <span class="comment"># override with plugin_params</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>            <span class="keywordflow">if</span> plugin_params.mapping_file <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                mapping_file_path = gulp_utils.build_mapping_file_path(</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>                    plugin_params.mapping_file</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>                )</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>            <span class="keywordflow">if</span> plugin_params.mapping_id <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                mapping_id = plugin_params.mapping_id</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>            <span class="keywordflow">if</span> plugin_params.pipeline <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>                pipeline = plugin_params.pipeline</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>        index_type_mappings = await elastic_api.index_get_mapping(</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>            elastic_api.elastic(), index, <span class="keyword">False</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        )</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>        <span class="comment"># index_type_mappings = await elastic_api.datastream_get_mapping(self.elastic, index + &#39;-template&#39;)</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        m: GulpMapping = await mappings_helper.get_enriched_mapping_for_ingestion(</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>            pipeline=pipeline,</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>            mapping_file_path=mapping_file_path,</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>            mapping_id=mapping_id,</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        )</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        <span class="keywordflow">return</span> index_type_mappings, m</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span> </div>
</div>
<div class="foldopen" id="foldopen00376" data-start="" data-end="">
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a381f36429810987d7e1a4603c3f4dfea">  376</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a381f36429810987d7e1a4603c3f4dfea">_call_record_to_gulp_document_funcs</a>(</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        self,</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        operation_id: int,</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>        client_id: int,</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        context: str,</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        source: str,</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        fs: TmpIngestStats,</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        record: any,</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        record_idx: int,</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        custom_mapping: GulpMapping = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        index_type_mapping: dict = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        plugin: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        plugin_params: GulpPluginParams = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>        record_to_gulp_document_fun: Callable = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>        **kwargs,</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    ) -&gt; list[GulpDocument]:</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>        <span class="stringliteral">&quot;&quot;&quot;Stub function to call stacked plugins record_to_document_gulp_document.</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="stringliteral">        Each function is called with the previously returned GulpDocument.</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span><span class="stringliteral">            operation_id (int): the operation ID associated with the record</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="stringliteral">            client_id (int): client ID performing the ingestion</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="stringliteral">            context (str): context associated with the record</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="stringliteral">            source (str): source of the record (source file name or path, usually)</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="stringliteral">            fs (TmpIngestStats): _description_</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="stringliteral">            record (any): a single record (first time) or a list of GulpDocument objects (in stacked plugins)</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span><span class="stringliteral">            record_idx (int): The index of the record in source.</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="stringliteral">            custom_mapping (GulpMapping, optional): The custom mapping to use for the conversion. Defaults to None.</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span><span class="stringliteral">            index_type_mapping (dict, optional): elastic search index type mappings { &quot;field&quot;: &quot;type&quot;, ... }. Defaults to None.</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="stringliteral">            plugin (str, optional): &quot;agent.type&quot; to be set in the GulpDocument. Defaults to None.</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="stringliteral">            plugin_params (GulpPluginParams, optional): The plugin parameters to use, if any. Defaults to None.</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="stringliteral">            record_to_gulp_document_fun (Callable, optional): function to parse record into a gulp document, if stacked this receives a list of GulpDocuments</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="stringliteral">            list[GulpDocument]: zero or more GulpDocument objects</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        <span class="comment"># plugin_params=deepcopy(plugin_params)</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        <span class="keywordflow">if</span> plugin_params <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>            plugin_params = <a class="code hl_class" href="classgulp_1_1plugin__internal_1_1_gulp_plugin_params.html">GulpPluginParams</a>()</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        docs = record</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        <span class="keywordflow">if</span> record_to_gulp_document_fun <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>            docs = await record_to_gulp_document_fun(</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>                operation_id,</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>                client_id,</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>                context,</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>                source,</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>                fs,</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                record,</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                record_idx,</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>                custom_mapping,</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>                index_type_mapping,</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>                plugin,</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>                plugin_params,</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>                **kwargs,</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>            )</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>        <span class="keywordflow">for</span> fun <span class="keywordflow">in</span> plugin_params.record_to_gulp_document_fun:</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>            docs = await fun(</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>                operation_id,</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>                client_id,</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>                context,</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>                source,</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>                fs,</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>                docs,</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>                record_idx,</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>                custom_mapping,</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>                index_type_mapping,</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>                plugin,</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>                plugin_params,</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>                **kwargs,</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>            )</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span> </div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        <span class="keywordflow">if</span> docs <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>            <span class="keywordflow">return</span> []</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>        <span class="keywordflow">return</span> docs</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span> </div>
</div>
<div class="foldopen" id="foldopen00455" data-start="" data-end="">
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a38a3b56e6818d69a12aa847ac980895e">  455</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a38a3b56e6818d69a12aa847ac980895e">record_to_gulp_document</a>(</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>        self,</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        operation_id: int,</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>        client_id: int,</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>        context: str,</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        source: str,</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>        fs: TmpIngestStats,</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        record: any,</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>        record_idx: int,</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>        custom_mapping: GulpMapping = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        index_type_mapping: dict = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        plugin: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>        plugin_params: GulpPluginParams = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        **kwargs,</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    ) -&gt; list[GulpDocument]:</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span><span class="stringliteral">        Converts a record to one or more GulpDocument objects based on the provided index mappings.</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="stringliteral">            operation_id (int): The operation ID associated with the record.</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="stringliteral">            client_id (int): The client ID associated with the record.</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><span class="stringliteral">            context (str): The context associated with the record.</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="stringliteral">            source (str): The source of the record (source file name or path, usually).</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="stringliteral">            fs (TmpIngestStats): The temporary ingestion statistics (may be updated on return).</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span><span class="stringliteral">            record (any): record to convert, plugin dependent format: note that here stacked plugins receives a list of GulpDocument objects instead (since the original record may generate one or more documents).</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span><span class="stringliteral">            record_idx (int): The index of the record in source.</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span><span class="stringliteral">            custom_mapping (GulpMapping, optional): The custom mapping to use for the conversion. Defaults to None.</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span><span class="stringliteral">            index_type_mapping (dict, optional): elastic search index type mappings { &quot;ecs_field&quot;: &quot;type&quot;, ... }. Defaults to None.</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="stringliteral">            plugin (str, optional): &quot;agent.type&quot; to be set in the GulpDocument. Defaults to None.</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="stringliteral">            plugin_params (GulpPluginParams, optional): The plugin parameters to use, if any. Defaults to None.</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="stringliteral">            extra (dict, optional): Additional fields to add to the GulpDocument (after applying mapping). Defaults to None.</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="stringliteral">            **kwargs: Additional keyword arguments:</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="stringliteral">            list[GulDocument]: The converted GulpDocument objects or None if an exception occurred (fs is updated then).</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="stringliteral">        Raises:</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="stringliteral">            NotImplementedError: This method is not implemented yet.</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>        <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">&quot;not implemented!&quot;</span>)</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
</div>
<div class="foldopen" id="foldopen00496" data-start="" data-end="">
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ab96082a9ecc6d0db5a48ee6958ac3239">  496</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ab96082a9ecc6d0db5a48ee6958ac3239">ingest</a>(</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        self,</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>        index: str,</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>        req_id: str,</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>        client_id: int,</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        operation_id: int,</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        context: str,</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>        source: str | list[dict],</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        ws_id: str,</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>        plugin_params: GulpPluginParams = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        flt: GulpIngestionFilter = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        **kwargs,</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    ) -&gt; GulpRequestStatus:</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="stringliteral">        Ingests a file using the plugin.</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="stringliteral">        NOTE: implementers should call super().ingest() in their implementation.</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="stringliteral">        NOTE: this function *SHOULD NOT* raise exceptions</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="stringliteral">            index (str): name of the elasticsearch index to ingest the document into.</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="stringliteral">            req_id (str): The request ID related to this ingestion (must exist on the collab db).</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="stringliteral">            client_id (int): The client ID performing the ingestion.</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="stringliteral">            operation_id (int): The operation ID related to this ingestion.</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="stringliteral">            context (str): Context related to this ingestion.</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="stringliteral">            source (str|list[dict]): The path to the file to ingest, or a list of events dicts.</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="stringliteral">            ws_id (str): The websocket ID</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="stringliteral">            plugin_params (GulpPluginParams): additional parameters to pass to the ingestion function. Defaults to None.</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="stringliteral">            flt (GulpIngestionFilter, optional): filter to apply to this ingestion, if any. Defaults to None.</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="stringliteral">            kwargs: additional arguments if any</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a1370c514cd93cb996ddf27f0400840bc">req_id</a> = req_id</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a12087c1690a56089011c8e1a9f4e319e">client_id</a> = client_id</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#ad1f1eb15a79c7b61e759632d9333976b">operation_id</a> = operation_id</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#aed88676be607a3199e7b417512f3d8f1">context</a> = context</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a333f06e1a7df05effecbc6a8fa238cca">ws_id</a> = ws_id</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a0d326931fdde686f05f73ed00cad6f36">index</a> = index</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>        <span class="comment"># raise NotImplementedError(&quot;not implemented!&quot;)</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
</div>
<div class="foldopen" id="foldopen00535" data-start="" data-end="">
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#acc159cfa2b2d043ffa24a5f62e5c80a3">  535</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#acc159cfa2b2d043ffa24a5f62e5c80a3">pipeline</a>(</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        self, plugin_params: GulpPluginParams = <span class="keywordtype">None</span>, **kwargs</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    ) -&gt; ProcessingPipeline:</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="stringliteral">        Returns the pysigma processing pipeline for the plugin, if any.</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="stringliteral">            plugin_params (GulpPluginParams, optional): additional parameters to pass to the pipeline. Defaults to None.</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="stringliteral">            kwargs: additional arguments if any.</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="stringliteral">            ProcessingPipeline: The processing pipeline.</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>        <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">&quot;not implemented!&quot;</span>)</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
</div>
<div class="foldopen" id="foldopen00549" data-start="" data-end="">
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a840f5d608e3e60e19ad6aca18e0b5abf">  549</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a840f5d608e3e60e19ad6aca18e0b5abf">cleanup</a>(self) -&gt; None:</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="stringliteral">        Optional cleanup routine to call on unload.</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
</div>
<div class="foldopen" id="foldopen00555" data-start="" data-end="">
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a375c2c0b188733c1f35fcc20865965bf">  555</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a375c2c0b188733c1f35fcc20865965bf">_build_gulpdocuments</a>(</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        self,</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        fme: list[FieldMappingEntry],</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        idx: int,</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        operation_id: int,</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        context: str,</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        plugin: str,</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        client_id: int,</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>        raw_event: str,</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        original_id: str,</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        src_file: str,</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        timestamp: int = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>        timestamp_nsec: int = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>        event_code: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        cat: list[str] = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>        duration_nsec: int = 0,</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        gulp_log_level: GulpLogLevel = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>        original_log_level: str = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        remove_raw_event: bool = <span class="keyword">False</span>,</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>        **kwargs,</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    ) -&gt; list[GulpDocument]:</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span><span class="stringliteral">        build one or more GulpDocument objects from a list of FieldMappingEntry objects:</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="stringliteral">        this function creates as many GulpDocument objects as there are FieldMappingEntry objects with is_timestamp=True.</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span><span class="stringliteral">        if no FieldMappingEntry object has is_timestamp=True, it creates a single GulpDocument object with the first FieldMappingEntry object.</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>        docs: list[GulpDocument] = []</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        append_doc = docs.append  <span class="comment"># local variable for faster access</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span> </div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        common_params = {</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>            <span class="stringliteral">&quot;idx&quot;</span>: idx,</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>            <span class="stringliteral">&quot;operation_id&quot;</span>: operation_id,</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            <span class="stringliteral">&quot;context&quot;</span>: context,</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            <span class="stringliteral">&quot;plugin&quot;</span>: plugin,</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>            <span class="stringliteral">&quot;client_id&quot;</span>: client_id,</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            <span class="stringliteral">&quot;raw_event&quot;</span>: raw_event,</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>            <span class="stringliteral">&quot;original_id&quot;</span>: original_id,</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>            <span class="stringliteral">&quot;src_file&quot;</span>: src_file,</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>            <span class="stringliteral">&quot;timestamp&quot;</span>: timestamp,</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            <span class="stringliteral">&quot;timestamp_nsec&quot;</span>: timestamp_nsec,</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>            <span class="stringliteral">&quot;event_code&quot;</span>: event_code,</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>            <span class="stringliteral">&quot;cat&quot;</span>: cat,</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>            <span class="stringliteral">&quot;duration_nsec&quot;</span>: duration_nsec,</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>            <span class="stringliteral">&quot;gulp_log_level&quot;</span>: gulp_log_level,</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>            <span class="stringliteral">&quot;original_log_level&quot;</span>: original_log_level,</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>            **kwargs,</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>        }</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>        <span class="keywordflow">for</span> f <span class="keywordflow">in</span> fme:</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>            <span class="comment"># print(&quot;%s\n\n&quot; % (f))</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>            <span class="comment"># for each is_timestamp build a gulpdocument with all the fields in fme</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>            <span class="keywordflow">if</span> f.is_timestamp:</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>                d = GulpDocument(fme=fme, f=f, **common_params)</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>                <span class="keywordflow">if</span> remove_raw_event:</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>                    d.original_event = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span> </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                <span class="comment"># print(&quot;%s\n\n&quot; % (d))</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>                append_doc(d)</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        <span class="keywordflow">if</span> len(docs) == 0:</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            <span class="comment"># create a document with the given timestamp in timestamp/timestamp_nsec (if any, either it will be set to 0/invalid)</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>            d = GulpDocument(fme=fme, **common_params)</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>            <span class="keywordflow">if</span> remove_raw_event:</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>                d.original_event = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>            append_doc(d)</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>        <span class="keywordflow">return</span> docs</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
</div>
<div class="foldopen" id="foldopen00623" data-start="" data-end="">
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ac5c86b4ede215ac0ba20d028ad717c3e">  623</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ac5c86b4ede215ac0ba20d028ad717c3e">get_unmapped_field_name</a>(self, field: str) -&gt; str:</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span><span class="stringliteral">        Returns the name of the unmapped field.</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span><span class="stringliteral">        Parameters:</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span><span class="stringliteral">        - field (str): The name of the field.</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="stringliteral">        - str: The name of the unmapped field.</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> elastic_api.UNMAPPED_PREFIX:</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>            <span class="keywordflow">return</span> field</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{elastic_api.UNMAPPED_PREFIX}.{field}&quot;</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
</div>
<div class="foldopen" id="foldopen00638" data-start="" data-end="">
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#acfc929fce907dcf945a52ffb8dc5b2ed">  638</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#acfc929fce907dcf945a52ffb8dc5b2ed">_type_checks</a>(self, v: any, k: str, index_type_mapping: dict) -&gt; any:</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="stringliteral">        check if the value should be fixed based on the index type mapping</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="stringliteral">            v (any): The value to check.</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span><span class="stringliteral">            k (str): The mapped field (i.e. &quot;user.id&quot;, may also be an unmapped (i.e. &quot;gulp.unmapped&quot;) field)</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span><span class="stringliteral">            index_type_mapping (dict): The elasticsearch index key-&gt;type mappings.</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="keywordflow">if</span> k <span class="keywordflow">not</span> <span class="keywordflow">in</span> index_type_mapping:</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>            <span class="comment"># _logger.debug(&quot;key %s not found in index_type_mapping&quot; % (k))</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>            <span class="keywordflow">return</span> str(v)</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        index_type = index_type_mapping[k]</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <span class="keywordflow">if</span> index_type == <span class="stringliteral">&quot;long&quot;</span>:</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>            <span class="comment"># self.logger().debug(&quot;converting %s:%s to long&quot; % (k, v))</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>            <span class="keywordflow">if</span> isinstance(v, str):</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>                <span class="keywordflow">if</span> v.isnumeric():</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>                    <span class="keywordflow">return</span> int(v)</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                <span class="keywordflow">if</span> v.startswith(<span class="stringliteral">&quot;0x&quot;</span>):</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>                    <span class="keywordflow">return</span> int(v, 16)</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>            <span class="keywordflow">return</span> v</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span> </div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        <span class="keywordflow">if</span> index_type == <span class="stringliteral">&quot;date&quot;</span> <span class="keywordflow">and</span> isinstance(v, str) <span class="keywordflow">and</span> v.lower().startswith(<span class="stringliteral">&quot;0x&quot;</span>):</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>            <span class="comment"># convert hex to int</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>            <span class="keywordflow">return</span> int(v, 16)</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        <span class="keywordflow">if</span> index_type == <span class="stringliteral">&quot;keyword&quot;</span> <span class="keywordflow">or</span> index_type == <span class="stringliteral">&quot;text&quot;</span>:</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            <span class="comment"># self.logger().debug(&quot;converting %s:%s to keyword&quot; % (k, v))</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>            <span class="keywordflow">return</span> str(v)</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span> </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <span class="keywordflow">if</span> index_type == <span class="stringliteral">&quot;ip&quot;</span>:</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>            <span class="comment"># self.logger().debug(&quot;converting %s:%s to ip&quot; % (k, v))</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>            <span class="keywordflow">if</span> <span class="stringliteral">&quot;local&quot;</span> <span class="keywordflow">in</span> v.lower():</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;127.0.0.1&quot;</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>                ipaddress.ip_address(v)</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            <span class="keywordflow">except</span> ValueError <span class="keyword">as</span> ex:</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>                _logger.exception(ex)</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        <span class="comment"># add more types here if needed ...</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        <span class="comment"># self.logger().debug(&quot;returning %s:%s&quot; % (k, v))</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>        <span class="keywordflow">return</span> str(v)</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span> </div>
</div>
<div class="foldopen" id="foldopen00683" data-start="" data-end="">
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a4b661e5352802554dc25028526496f7b">  683</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a4b661e5352802554dc25028526496f7b">_map_source_key</a>(</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>        self,</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>        plugin_params: GulpPluginParams,</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        custom_mapping: GulpMapping,</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        source_key: str,</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>        v: Any,</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        index_type_mapping: dict = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        ignore_custom_mapping: bool = <span class="keyword">False</span>,</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        **kwargs,</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    ) -&gt; list[FieldMappingEntry]:</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span><span class="stringliteral">        map source key to a field mapping entry with &quot;result&quot;: {mapped_key: v}</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span><span class="stringliteral">            plugin_params (GulpPluginParams): The plugin parameters.</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span><span class="stringliteral">            custom_mapping (GulpMapping): The custom mapping.</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span><span class="stringliteral">            source_key (str): The key to look for(=the event record key to be mapped) in the custom_mapping dictionary</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span><span class="stringliteral">            v (any): value to set for mapped key/s.</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span><span class="stringliteral">            index_type_mapping (dict, optional): The elasticsearch index key-&gt;type mappings. Defaults to None.</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span><span class="stringliteral">            ignore_custom_mapping (bool, optional): Whether to ignore custom_mapping and directly map source_key to v. Defaults to False.</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span><span class="stringliteral">            kwargs: Additional keyword arguments.</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span><span class="stringliteral">            list[FieldMappingEntry]: zero or more FieldMappingEntry objects with &quot;result&quot; set.</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>        <span class="comment"># get mapping and option from custom_mapping</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>        <span class="keywordflow">if</span> index_type_mapping <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>            index_type_mapping = {}</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>        <span class="comment"># _logger.debug(&#39;len index type mapping=%d&#39; % (len(index_type_mapping)))</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>        mapping_dict: dict = custom_mapping.fields</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>        mapping_options = (</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>            custom_mapping.options</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            <span class="keywordflow">if</span> custom_mapping.options <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            <span class="keywordflow">else</span> GulpMappingOptions()</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>        )</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>        <span class="comment"># basic checks</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>        <span class="keywordflow">if</span> v == <span class="stringliteral">&quot;-&quot;</span> <span class="keywordflow">or</span> v <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>            <span class="keywordflow">return</span> []</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span> </div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>        <span class="keywordflow">if</span> isinstance(v, str):</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>            v = v.strip()</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> v <span class="keywordflow">and</span> mapping_options.ignore_blanks:</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>                <span class="comment"># not adding blank strings</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                <span class="keywordflow">return</span> []</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span> </div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>        <span class="comment"># fix value if needed, and add to extra</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>        <span class="keywordflow">if</span> ignore_custom_mapping <span class="keywordflow">or</span> (</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>            plugin_params <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> plugin_params.ignore_mapping_ingest</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>        ):</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            <span class="comment"># direct mapping, no need to check custom_mappings</span></div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>            <span class="keywordflow">return</span> [FieldMappingEntry(result={source_key: v})]</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span> </div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>        <span class="keywordflow">if</span> source_key <span class="keywordflow">not</span> <span class="keywordflow">in</span> mapping_dict:</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>            <span class="comment"># self.logger().error(&#39;key &quot;%s&quot; not found in custom mapping, mapping_dict=%s!&#39; % (source_key, muty.string.make_shorter(str(mapping_dict))))</span></div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>            <span class="comment"># key not found in custom_mapping, check if we have to map it anyway</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> mapping_options.ignore_unmapped:</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                <span class="keywordflow">return</span> [</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>                    FieldMappingEntry(</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>                        result={self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ac5c86b4ede215ac0ba20d028ad717c3e">get_unmapped_field_name</a>(source_key): str(v)}</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>                    )</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>                ]</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span> </div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>        <span class="comment"># there is a mapping defined to be processed</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        fm: FieldMappingEntry = mapping_dict[source_key]</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>        map_to_list = (</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>            [fm.map_to] <span class="keywordflow">if</span> isinstance(fm.map_to, (str, <a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a48d7d6a080b67ba8c58522a1e05ce930">type</a>(<span class="keywordtype">None</span>))) <span class="keywordflow">else</span> fm.map_to</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        )</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span> </div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        <span class="comment"># in the end, this function will return a list of FieldMappingEntry objects with &quot;result&quot; set: these results will be used to create the GulpDocument object</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>        fme_list: list[FieldMappingEntry] = []</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        <span class="keywordflow">for</span> k <span class="keywordflow">in</span> map_to_list:</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>            <span class="comment"># make a copy of fme without using deepcopy)</span></div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>            dest_fm = FieldMappingEntry(</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>                is_timestamp=fm.is_timestamp,</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>                event_code=fm.event_code,</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>                do_multiply=fm.do_multiply,</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>                is_timestamp_chrome=fm.is_timestamp_chrome,</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>                is_variable_mapping=fm.is_variable_mapping,</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>                result={},</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>            )</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>            <span class="comment"># check if it is a number and/or a timestamp (including chrome timestamp, which is a special case)</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>            is_numeric = isinstance(v, int) <span class="keywordflow">or</span> str(v).isnumeric()</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>            <span class="keywordflow">if</span> is_numeric:</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>                v = int(v)</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>                <span class="comment"># ensure chrome timestamp is properly converted to nanos</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>                <span class="comment"># _logger.debug(&#39;***** is_numeric, v=%d&#39; % (v))</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>                <span class="keywordflow">if</span> fm.is_timestamp_chrome:</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>                    v = int(muty.time.chrome_epoch_to_nanos(v))</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>                    <span class="comment"># _logger.debug(&#39;***** is_timestamp_chrome, v nsec=%d&#39; % (v))</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span> </div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>                <span class="keywordflow">if</span> fm.do_multiply <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>                    <span class="comment"># apply a multipler if any (must turn v to nanoseconds)</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>                    <span class="comment"># _logger.debug(&quot;***** is_numeric, multiply, v=%d&quot; % (v))</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>                    v = int(v * fm.do_multiply)</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>                    <span class="comment"># _logger.debug(&quot;***** is_numeric, AFTER multiply, v=%d&quot; % (v))</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span> </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>            <span class="keywordflow">elif</span> isinstance(v, str) <span class="keywordflow">and</span> fm.is_timestamp:</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>                v = int(</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>                    muty.time.string_to_epoch_nsec(</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>                        v,</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>                        utc=mapping_options.timestamp_utc,</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>                        dayfirst=mapping_options.timestamp_dayfirst,</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>                        yearfirst=mapping_options.timestamp_yearfirst,</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>                    )</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>                )</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>                <span class="comment"># _logger.debug(&#39;***** str and is_timestamp, v nsec=%d&#39; % (v))</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>            <span class="keywordflow">if</span> fm.is_timestamp:</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>                <span class="comment"># it&#39;s a timestamp, another event will be generated</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>                vv = muty.time.nanos_to_millis(v)</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>                dest_fm.result[<span class="stringliteral">&quot;@timestamp&quot;</span>] = vv</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>                dest_fm.result[<span class="stringliteral">&quot;@timestamp_nsec&quot;</span>] = v</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>                <span class="comment"># _logger.debug(&#39;***** timestamp nanos, v=%d&#39; % (v))</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>                <span class="comment"># _logger.debug(&#39;***** timestamp to millis, v=%d&#39; % (vv))</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span> </div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>            <span class="keywordflow">if</span> fm.is_timestamp <span class="keywordflow">or</span> fm.is_timestamp_chrome:</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>                <span class="comment"># _logger.debug(&#39;***** timestamp or timestamp_chrome, v=%d&#39; % (v))</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>                <span class="keywordflow">if</span> v &lt; 0:</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>                    <span class="comment"># _logger.debug(&#39;***** adding invalid timestamp&#39;)</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>                    v = 0</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>                    GulpDocument.add_invalid_timestamp(dest_fm.result)</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>                <span class="keywordflow">if</span> k <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>                    <span class="comment"># also add to mapped key</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>                    dest_fm.result[k] = v</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>                <span class="comment"># not a timestamp, map</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                <span class="keywordflow">if</span> k <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                    <span class="comment"># add unmapped</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                    k = self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ac5c86b4ede215ac0ba20d028ad717c3e">get_unmapped_field_name</a>(source_key)</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>                    v = self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#acfc929fce907dcf945a52ffb8dc5b2ed">_type_checks</a>(v, k, index_type_mapping)</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>                dest_fm.result[k] = v</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span> </div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>            fme_list.append(dest_fm)</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>            <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span><span class="stringliteral">            self.logger().debug(&#39;FME LIST FOR THIS RECORD:&#39;)</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span><span class="stringliteral">            for p in fme_list:</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span><span class="stringliteral">                self.logger().debug(p)</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span><span class="stringliteral">            self.logger().debug(&#39;---------------------------------&#39;)</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="stringliteral">            &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>        <span class="keywordflow">return</span> fme_list</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span> </div>
</div>
<div class="foldopen" id="foldopen00826" data-start="" data-end="">
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a17fb4d6dbb155ae0f0646e3d9814fc01">  826</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a17fb4d6dbb155ae0f0646e3d9814fc01">_build_ingestion_chunk_for_ws</a>(</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>        self, docs: list[dict], flt: GulpIngestionFilter = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>    ) -&gt; list[dict]:</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span><span class="stringliteral">        Builds the ingestion chunk for the websocket, filtering if needed.</span></div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        <span class="comment"># self.logger().debug(&quot;building ingestion chunk, flt=%s&quot; % (flt))</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> docs:</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>            <span class="keywordflow">return</span> []</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        ws_docs = [</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>            {</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>                <span class="stringliteral">&quot;_id&quot;</span>: doc[<span class="stringliteral">&quot;_id&quot;</span>],</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>                <span class="stringliteral">&quot;@timestamp&quot;</span>: doc[<span class="stringliteral">&quot;@timestamp&quot;</span>],</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>                <span class="stringliteral">&quot;gulp.source.file&quot;</span>: doc[<span class="stringliteral">&quot;gulp.source.file&quot;</span>],</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>                <span class="stringliteral">&quot;event.duration&quot;</span>: doc[<span class="stringliteral">&quot;event.duration&quot;</span>],</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>                <span class="stringliteral">&quot;gulp.context&quot;</span>: doc[<span class="stringliteral">&quot;gulp.context&quot;</span>],</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>                <span class="stringliteral">&quot;gulp.log.level&quot;</span>: doc.get(<span class="stringliteral">&quot;gulp.log.level&quot;</span>, int(GulpLogLevel.INFO)),</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>                <span class="stringliteral">&quot;event.category&quot;</span>: doc.get(<span class="stringliteral">&quot;event.category&quot;</span>, <span class="keywordtype">None</span>),</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>                <span class="stringliteral">&quot;event.code&quot;</span>: doc[<span class="stringliteral">&quot;event.code&quot;</span>],</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>                <span class="stringliteral">&quot;gulp.event.code&quot;</span>: doc[<span class="stringliteral">&quot;gulp.event.code&quot;</span>],</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>            }</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>            <span class="keywordflow">for</span> doc <span class="keywordflow">in</span> docs</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>            <span class="keywordflow">if</span> elastic_api.filter_doc_for_ingestion(</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>                doc, flt, ignore_store_all_documents=<span class="keyword">True</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>            )</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>            == GulpEventFilterResult.ACCEPT</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>        ]</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>        <span class="keywordflow">return</span> ws_docs</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
</div>
<div class="foldopen" id="foldopen00857" data-start="" data-end="">
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a400aabb1893cbe98511a69414c8e58a2">  857</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a400aabb1893cbe98511a69414c8e58a2">_flush_buffer</a>(</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>        self,</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>        index: str,</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>        fs: TmpIngestStats,</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>        ws_id: str,</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>        req_id: str,</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>        flt: GulpIngestionFilter = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>        wait_for_refresh: bool = <span class="keyword">False</span>,</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    ) -&gt; TmpIngestStats:</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span><span class="stringliteral">        NOTE: errors appended by this function are intended as INGESTION errors:</span></div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span><span class="stringliteral">        it means something wrong with the format of the event, and must be fixed ASAP if this happens.</span></div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span><span class="stringliteral">        ideally, function should NEVER append errors and the errors total should be the same before and after this function returns (this function may only change the skipped total, which means some duplicates were found).</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        <span class="keywordflow">if</span> len(self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">buffer</a>) == 0:</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>            <span class="comment"># already flushed</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>            <span class="keywordflow">return</span> fs</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span> </div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        <span class="comment"># _logger.debug(&#39;flushing ingestion buffer, len=%d&#39; % (len(self.buffer)))</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>        skipped, failed, failed_ar, ingested_docs = await elastic_api.ingest_bulk(</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>            self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a85ca465c1498add707b193266a2dc717">elastic</a>, index, self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">buffer</a>, flt=flt, wait_for_refresh=wait_for_refresh</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>        )</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>        <span class="comment"># print(json.dumps(ingested_docs, indent=2))</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span> </div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>        <span class="keywordflow">if</span> failed &gt; 0:</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>            <span class="keywordflow">if</span> config.debug_abort_on_elasticsearch_ingestion_error():</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                <span class="keywordflow">raise</span> Exception(</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>                    <span class="stringliteral">&quot;elasticsearch ingestion errors means GulpDocument contains invalid data, review errors on collab db!&quot;</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>                )</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">buffer</a> = []</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span> </div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>        <span class="comment"># build ingestion chunk</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>        ws_docs = self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a17fb4d6dbb155ae0f0646e3d9814fc01">_build_ingestion_chunk_for_ws</a>(ingested_docs, flt)</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span> </div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>        <span class="comment"># send ingested docs to websocket</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>        <span class="keywordflow">if</span> len(ws_docs) &gt; 0:</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            ws_api.shared_queue_add_data(</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>                WsQueueDataType.INGESTION_CHUNK,</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>                req_id,</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>                {<span class="stringliteral">&quot;plugin&quot;</span>: self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a3cc5beb95fb74f4be44c04f84ed66a82">name</a>(), <span class="stringliteral">&quot;events&quot;</span>: ws_docs},</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>                ws_id=ws_id,</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>            )</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span> </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <span class="comment"># update stats</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        fs = fs.update(</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>            failed=failed,</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>            skipped=skipped,</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>            ingest_errors=failed_ar,</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>        )</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>        <span class="keywordflow">return</span> fs</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span> </div>
</div>
<div class="foldopen" id="foldopen00910" data-start="" data-end="">
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#ad9cf9630b6d3e7ae9eab1b880e786222">  910</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#ad9cf9630b6d3e7ae9eab1b880e786222">_ingest_record</a>(</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>        self,</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>        index: str,</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>        doc: GulpDocument | dict,</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>        fs: TmpIngestStats,</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>        ws_id: str,</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>        req_id: str,</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>        flt: GulpIngestionFilter = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>        flush_enabled: bool = <span class="keyword">True</span>,</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>        **kwargs,</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    ) -&gt; TmpIngestStats:</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span><span class="stringliteral">        bufferize as much as ingestion_buffer_size, then flush (writes to elasticsearch)</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>        ingestion_buffer_size = config.config().get(<span class="stringliteral">&quot;ingestion_buffer_size&quot;</span>, 1000)</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>        self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">buffer</a>.append(doc)</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>        <span class="keywordflow">if</span> len(self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">buffer</a>) &gt;= ingestion_buffer_size <span class="keywordflow">and</span> flush_enabled:</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>            <span class="comment"># time to flush</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>            fs = await self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a400aabb1893cbe98511a69414c8e58a2">_flush_buffer</a>(index, fs, ws_id, req_id, flt)</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span> </div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>        <span class="keywordflow">return</span> fs</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span> </div>
</div>
<div class="foldopen" id="foldopen00932" data-start="" data-end="">
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a28ec6d78487be57c105863d9f58904e7">  932</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a28ec6d78487be57c105863d9f58904e7">_parser_failed</a>(</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>        self, fs: TmpIngestStats, source: str | dict, ex: Exception | str</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    ) -&gt; TmpIngestStats:</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span><span class="stringliteral">        whole source failed ingestion (error happened before the record parsing loop), helper to update stats</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>        self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>().exception(</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>            <span class="stringliteral">&quot;PARSER FAILED: source=%s, ex=%s&quot;</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>            % (muty.string.make_shorter(str(source), 260), ex)</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>        )</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>        fs = fs.update(ingest_errors=[ex], parser_failed=1)</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>        <span class="keywordflow">return</span> fs</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span> </div>
</div>
<div class="foldopen" id="foldopen00945" data-start="" data-end="">
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a1993e16b2333cb1bb281eaa81828c326">  945</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a1993e16b2333cb1bb281eaa81828c326">_record_failed</a>(</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>        self, fs: TmpIngestStats, entry: any, source: str | dict, ex: Exception | str</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    ) -&gt; TmpIngestStats:</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span><span class="stringliteral">        record failed ingestion (in the record parser loop), helper to update stats</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span><span class="stringliteral">            fs (TmpIngestStats): The temporary ingestion statistics.</span></div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span><span class="stringliteral">            entry (any): The entry that failed.</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span><span class="stringliteral">            source (str): The source of the record.</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span><span class="stringliteral">            ex (Exception|str): The exception that caused the failure.</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span><span class="stringliteral">            TmpIngestStats: The updated temporary ingestion statistics.</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        <span class="comment"># self.logger().exception(&quot;RECORD FAILED: source=%s, record=%s, ex=%s&quot; % (muty.string.make_shorter(str(source),260), muty.string.make_shorter(str(entry),260), ex))</span></div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>        fs = fs.update(failed=1, ingest_errors=[ex])</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        <span class="keywordflow">return</span> fs</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span> </div>
</div>
<div class="foldopen" id="foldopen00963" data-start="" data-end="">
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno"><a class="line" href="classgulp_1_1plugin_1_1_plugin_base.html#a0f3983f38b1d29c20df0dd5a496359af">  963</a></span>    <span class="keyword">async def </span><a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a0f3983f38b1d29c20df0dd5a496359af">_finish_ingestion</a>(</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>        self,</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>        index: str,</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        source: str | dict,</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>        req_id: str,</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>        client_id: int,</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        ws_id: str,</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>        fs: TmpIngestStats,</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>        flt: GulpIngestionFilter = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    ) -&gt; GulpRequestStatus:</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span><span class="stringliteral">        to be called whenever ingest() must exit: flushes the buffer and updates the ingestion stats</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>            <span class="comment"># finally flush ingestion buffer</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>            fs = await self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#a400aabb1893cbe98511a69414c8e58a2">_flush_buffer</a>(index, fs, ws_id, req_id, flt)</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>            self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>().info(</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>                <span class="stringliteral">&quot;INGESTION DONE FOR source=%s,\n\tclient_id=%d (processed=%d, failed=%d, skipped=%d, errors=%d, parser_errors=%d)&quot;</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>                % (</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>                    muty.string.make_shorter(str(source), 260),</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>                    client_id,</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>                    fs.ev_processed,</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>                    fs.ev_failed,</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>                    fs.ev_skipped,</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>                    len(fs.ingest_errors),</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>                    fs.parser_failed,</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>                )</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>            )</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> ex:</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>            fs = fs.update(ingest_errors=[ex])</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>            self.<a class="code hl_function" href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">logger</a>().exception(</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>                <span class="stringliteral">&quot;FAILED finalizing ingestion for source=%s&quot;</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>                % (muty.string.make_shorter(str(source), 260))</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>            )</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span> </div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>        <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>            status, _ = await GulpStats.update(</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>                self.<a class="code hl_variable" href="classgulp_1_1plugin_1_1_plugin_base.html#af2760b1eea7c1b7f2459abf2872cbac6">collab</a>,</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>                req_id,</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>                ws_id,</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>                fs=fs,</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>                force=<span class="keyword">True</span>,</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>                file_done=<span class="keyword">True</span>,</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>            )</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>        <span class="keywordflow">return</span> status</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span> </div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span> </div>
</div>
</div>
<div class="foldopen" id="foldopen01010" data-start="" data-end="">
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#abb00832220a7a4b752ad4e752efdc946"> 1010</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#abb00832220a7a4b752ad4e752efdc946">_get_plugin_path</a>(plugin: str, **kwargs) -&gt; str:</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span> </div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    <span class="comment"># try plain .py first</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="comment"># TODO: on license manager, disable plain .py load (only encrypted pyc)</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>    <span class="comment"># get path according to plugin type</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    plugin_type = kwargs.get(<span class="stringliteral">&quot;plugin_type&quot;</span>, GulpPluginType.INGESTION)</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    path_plugins = config.path_plugins(plugin_type)</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span> </div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>    ppy = muty.file.safe_path_join(path_plugins, plugin + <span class="stringliteral">&quot;.py&quot;</span>)</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> muty.file.exists(ppy):</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>        <span class="comment"># try pyc</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>        ppyc = muty.file.safe_path_join(path_plugins, plugin + <span class="stringliteral">&quot;.pyc&quot;</span>)</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> muty.file.exists(ppyc):</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>            <span class="keywordflow">raise</span> ObjectNotFound(</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>                <span class="stringliteral">&quot;plugin %s not found (tried %s, %s)&quot;</span> % (plugin, ppy, ppyc)</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>            )</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>        <span class="keywordflow">return</span> ppyc</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="keywordflow">return</span> ppy</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span> </div>
</div>
<div class="foldopen" id="foldopen01030" data-start="" data-end="">
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a9b05fe36b952a46571666d228d193558"> 1030</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a9b05fe36b952a46571666d228d193558">load_plugin</a>(</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    plugin: str,</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>    collab: AsyncEngine = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    elastic: AsyncElasticsearch = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>    **kwargs,</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>) -&gt; PluginBase:</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span><span class="stringliteral">    Load a plugin from a given path or from the default plugin path.</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span><span class="stringliteral">        plugin (str): The name or path of the plugin to load.</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span><span class="stringliteral">        req_id (str, optional): The request ID to associate with the plugin loading. Defaults to None.</span></div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span><span class="stringliteral">        collab (AsyncEngine, optional): The SQLAlchemy engine instance. Defaults to None (not needed for pysigma plugins).</span></div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span><span class="stringliteral">        elastic (AsyncElasticsearch, optional): The Elasticsearch client instance. Defaults to None (not needed for pysigma plugins).</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span><span class="stringliteral">        kwargs: additional arguments:</span></div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span><span class="stringliteral">            &quot;plugin_type&quot; (GulpPluginType, default=GulpPluginType.INGESTION)</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span><span class="stringliteral">        PluginBase: The loaded plugin.</span></div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span><span class="stringliteral">    Raises:</span></div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span><span class="stringliteral">        Exception: If the plugin could not be loaded.</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    _logger.debug(</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>        <span class="stringliteral">&quot;load_plugin %s, collab=%s, elastic=%s ...&quot;</span> % (plugin, collab, elastic)</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    )</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span> </div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>    m = <a class="code hl_function" href="namespacegulp_1_1plugin.html#a8d88e1de40580ca31b2c05838fdfc03f">plugin_cache_get</a>(plugin)</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    <span class="keywordflow">if</span> m <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>        <span class="keywordflow">return</span> m.Plugin(plugin, collab, elastic, **kwargs)</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span> </div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>    <span class="keywordflow">if</span> <span class="stringliteral">&quot;/&quot;</span> <span class="keywordflow">in</span> plugin:</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>        <span class="comment"># plugins is an absolute path</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>        path = muty.file.abspath(plugin)</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>        <span class="comment"># uses &quot;plugin_type&quot; to load from the correct subfolder</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        path = <a class="code hl_function" href="namespacegulp_1_1plugin.html#abb00832220a7a4b752ad4e752efdc946">_get_plugin_path</a>(plugin, **kwargs)</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span> </div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        m: PluginBase = muty.dynload.load_dynamic_module_from_file(path)</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> ex:</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>        <span class="keywordflow">raise</span> Exception(</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>            <span class="stringliteral">&quot;load_dynamic_module_from_file() failed, could not load plugin %s !&quot;</span></div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>            % (path)</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>        ) <span class="keyword">from</span> ex</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span> </div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    mod: PluginBase = m.Plugin(path, collab, elastic, **kwargs)</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    _logger.debug(<span class="stringliteral">&quot;loaded plugin: %s&quot;</span> % (mod.name()))</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <a class="code hl_function" href="namespacegulp_1_1plugin.html#a1c5c9184d00e49a445eb6b8f77ad60a3">plugin_cache_add</a>(m, plugin)</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span> </div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    <span class="keywordflow">return</span> mod</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span> </div>
</div>
<div class="foldopen" id="foldopen01082" data-start="" data-end="">
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a5af35dd01859f67f273a67cc0c774701"> 1082</a></span><span class="keyword">async def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a5af35dd01859f67f273a67cc0c774701">list_plugins</a>() -&gt; list[dict]:</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span><span class="stringliteral">    List all available plugins.</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span><span class="stringliteral">        list[dict]: The list of available plugins.</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    path_plugins = config.path_plugins()</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    files = await muty.file.list_directory_async(path_plugins, <span class="stringliteral">&quot;*.py*&quot;</span>, recursive=<span class="keyword">True</span>)</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>    l = []</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>    <span class="keywordflow">for</span> f <span class="keywordflow">in</span> files:</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        <span class="keywordflow">if</span> <span class="stringliteral">&quot;__init__&quot;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> f <span class="keywordflow">and</span> <span class="stringliteral">&quot;__pycache__&quot;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> f:</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>                p = <a class="code hl_function" href="namespacegulp_1_1plugin.html#a9b05fe36b952a46571666d228d193558">load_plugin</a>(f)</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>                n = {</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>                    <span class="stringliteral">&quot;name&quot;</span>: p.name(),</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>                    <span class="stringliteral">&quot;type&quot;</span>: str(p.type()),</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>                    <span class="stringliteral">&quot;desc&quot;</span>: p.desc(),</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>                    <span class="stringliteral">&quot;filename&quot;</span>: os.path.basename(p.path),</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>                    <span class="stringliteral">&quot;internal&quot;</span>: p.internal(),</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>                    <span class="stringliteral">&quot;options&quot;</span>: [o.to_dict() <span class="keywordflow">for</span> o <span class="keywordflow">in</span> p.options()],</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>                    <span class="stringliteral">&quot;depends_on&quot;</span>: p.depends_on(),</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>                    <span class="stringliteral">&quot;tags&quot;</span>: p.tags(),</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>                    <span class="stringliteral">&quot;event_type_field&quot;</span>: p.event_type_field(),</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>                    <span class="stringliteral">&quot;version&quot;</span>: p.version(),</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>                }</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>                l.append(n)</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>                <a class="code hl_function" href="namespacegulp_1_1plugin.html#a0e97ab32e715777b3ab97717986e594f">unload_plugin</a>(p)</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> ex:</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>                _logger.exception(ex)</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>                _logger.error(<span class="stringliteral">&quot;could not load plugin %s&quot;</span> % (f))</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>                <span class="keywordflow">continue</span></div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span> </div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>    <span class="keywordflow">return</span> l</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span> </div>
</div>
<div class="foldopen" id="foldopen01118" data-start="" data-end="">
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a01189de942f84e5d69c99d4e9ed054c7"> 1118</a></span><span class="keyword">async def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a01189de942f84e5d69c99d4e9ed054c7">get_plugin_tags</a>(plugin: str) -&gt; list[str]:</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span><span class="stringliteral">    Get the tags for a given (ingestion) plugin.</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span><span class="stringliteral">        plugin (str): The name of the plugin to get the tags for.</span></div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span><span class="stringliteral">        list[str]: The tags for the given plugin.</span></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    p = <a class="code hl_function" href="namespacegulp_1_1plugin.html#a9b05fe36b952a46571666d228d193558">load_plugin</a>(plugin)</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>    tags = p.tags()</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    <span class="keywordflow">return</span> tags</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span> </div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span> </div>
</div>
<div class="foldopen" id="foldopen01132" data-start="" data-end="">
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a0e97ab32e715777b3ab97717986e594f"> 1132</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a0e97ab32e715777b3ab97717986e594f">unload_plugin</a>(mod: PluginBase) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span><span class="stringliteral">    Unloads a plugin module by calling its `unload` method and deletes the module object</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span><span class="stringliteral">    NOTE: mod is **no more valid** after this function returns.</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span><span class="stringliteral">        mod (PluginBase): The plugin module to unload.</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span><span class="stringliteral">        run_gc (bool): if set, garbage collector is called after unloading the module. Defaults to True.</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span><span class="stringliteral">        None</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>    <span class="keywordflow">if</span> config.plugin_cache_enabled():</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span> </div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>    <span class="keywordflow">if</span> mod <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>        <span class="comment"># delete from cache if any</span></div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>        <span class="comment"># plugin_cache_delete(mod)</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span> </div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>        _logger.debug(<span class="stringliteral">&quot;unloading plugin: %s&quot;</span> % (mod.name()))</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>        mod.cleanup()</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>        del mod</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span> </div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span> </div>
</div>
<div class="foldopen" id="foldopen01157" data-start="" data-end="">
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a714b6e278c22eb32907dd3d4afa0b56d"> 1157</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a714b6e278c22eb32907dd3d4afa0b56d">plugin_cache_clear</a>() -&gt; None:</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span><span class="stringliteral">    Clear the process&#39;s own plugin cache.</span></div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span><span class="stringliteral">        None</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>    <span class="keyword">global</span> _cache</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> config.plugin_cache_enabled():</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span> </div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    _cache = {}</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span> </div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span> </div>
</div>
<div class="foldopen" id="foldopen01171" data-start="" data-end="">
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a49455ddc351f40d6438de1a81a68d742"> 1171</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a49455ddc351f40d6438de1a81a68d742">plugin_cache_remove</a>(plugin: str) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span><span class="stringliteral">    Remove a plugin from the process&#39;s own plugin cache.</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span><span class="stringliteral">        plugin (str): The name/path of the plugin to remove from the cache.</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span><span class="stringliteral">        None</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>    <span class="keyword">global</span> _cache</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> config.plugin_cache_enabled():</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span> </div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>    <span class="keywordflow">if</span> plugin <span class="keywordflow">in</span> _cache:</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        _logger.debug(<span class="stringliteral">&quot;removing plugin %s from cache&quot;</span> % (plugin))</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span> </div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>        <span class="comment"># cleanup module and delete</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>        m = _cache[plugin]</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>        del _cache[plugin]</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span> </div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
</div>
<div class="foldopen" id="foldopen01193" data-start="" data-end="">
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a1c5c9184d00e49a445eb6b8f77ad60a3"> 1193</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a1c5c9184d00e49a445eb6b8f77ad60a3">plugin_cache_add</a>(m: ModuleType, name: str) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span><span class="stringliteral">    Add a plugin to the process&#39;s own plugin cache.</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span><span class="stringliteral">        m (ModuleType): The plugin module to add to the cache.</span></div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span><span class="stringliteral">        name (str): The name/path of the plugin.</span></div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span><span class="stringliteral">        None</span></div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>    <span class="keyword">global</span> _cache</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> config.plugin_cache_enabled():</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span> </div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>    mm = _cache.get(name, <span class="keywordtype">None</span>)</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    <span class="keywordflow">if</span> mm <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>        _logger.debug(<span class="stringliteral">&quot;adding plugin %s (%s) to cache&quot;</span> % (name, m))</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>        _cache[name] = m</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span> </div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span> </div>
</div>
<div class="foldopen" id="foldopen01214" data-start="" data-end="">
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"><a class="line" href="namespacegulp_1_1plugin.html#a8d88e1de40580ca31b2c05838fdfc03f"> 1214</a></span><span class="keyword">def </span><a class="code hl_function" href="namespacegulp_1_1plugin.html#a8d88e1de40580ca31b2c05838fdfc03f">plugin_cache_get</a>(plugin: str) -&gt; ModuleType:</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span><span class="stringliteral">    Retrieve a plugin from the process&#39;s own plugin cache.</span></div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span><span class="stringliteral">        plugin (str): The name/path of the plugin to retrieve.</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span><span class="stringliteral">        ModuleType: The plugin module if found in the cache, otherwise None.</span></div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>    <span class="keyword">global</span> _cache</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> config.plugin_cache_enabled():</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span> </div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>    p = _cache.get(plugin, <span class="keywordtype">None</span>)</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>    <span class="keywordflow">if</span> p <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>        _logger.debug(<span class="stringliteral">&quot;found plugin %s in cache&quot;</span> % (plugin))</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>    <span class="keywordflow">return</span> p</div>
</div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html">gulp.plugin.PluginBase</a></div><div class="ttdef"><b>Definition</b> <a href="#l00055">plugin.py:55</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a01add25e2c2397d9ed56eca11d4105c0"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a01add25e2c2397d9ed56eca11d4105c0">gulp.plugin.PluginBase.depends_on</a></div><div class="ttdeci">list[str] depends_on(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00135">plugin.py:135</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a0373c98260b243f699a1e65849b1fcad"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a0373c98260b243f699a1e65849b1fcad">gulp.plugin.PluginBase.run_command</a></div><div class="ttdeci">dict run_command(self, GulpPluginParams p)</div><div class="ttdef"><b>Definition</b> <a href="#l00141">plugin.py:141</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a0d326931fdde686f05f73ed00cad6f36"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a0d326931fdde686f05f73ed00cad6f36">gulp.plugin.PluginBase.index</a></div><div class="ttdeci">str index</div><div class="ttdef"><b>Definition</b> <a href="#l00077">plugin.py:77</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a0e422abddcbb67f93856a6f754cbfef7"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a0e422abddcbb67f93856a6f754cbfef7">gulp.plugin.PluginBase.sigma_plugin_initialize</a></div><div class="ttdeci">ProcessingPipeline sigma_plugin_initialize(self, ProcessingPipeline pipeline=None, str mapping_file=None, str mapping_id=None, str product=None, GulpPluginParams plugin_params=None)</div><div class="ttdef"><b>Definition</b> <a href="#l00196">plugin.py:203</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a0f3983f38b1d29c20df0dd5a496359af"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a0f3983f38b1d29c20df0dd5a496359af">gulp.plugin.PluginBase._finish_ingestion</a></div><div class="ttdeci">GulpRequestStatus _finish_ingestion(self, str index, str|dict source, str req_id, int client_id, str ws_id, TmpIngestStats fs, GulpIngestionFilter flt=None)</div><div class="ttdef"><b>Definition</b> <a href="#l00963">plugin.py:972</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a12087c1690a56089011c8e1a9f4e319e"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a12087c1690a56089011c8e1a9f4e319e">gulp.plugin.PluginBase.client_id</a></div><div class="ttdeci">str client_id</div><div class="ttdef"><b>Definition</b> <a href="#l00078">plugin.py:78</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a1370c514cd93cb996ddf27f0400840bc"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a1370c514cd93cb996ddf27f0400840bc">gulp.plugin.PluginBase.req_id</a></div><div class="ttdeci">str req_id</div><div class="ttdef"><b>Definition</b> <a href="#l00076">plugin.py:76</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a159bff19598c519586a6301ea31a3dde"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a159bff19598c519586a6301ea31a3dde">gulp.plugin.PluginBase.buffer</a></div><div class="ttdeci">list buffer</div><div class="ttdef"><b>Definition</b> <a href="#l00086">plugin.py:86</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a17fb4d6dbb155ae0f0646e3d9814fc01"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a17fb4d6dbb155ae0f0646e3d9814fc01">gulp.plugin.PluginBase._build_ingestion_chunk_for_ws</a></div><div class="ttdeci">list[dict] _build_ingestion_chunk_for_ws(self, list[dict] docs, GulpIngestionFilter flt=None)</div><div class="ttdef"><b>Definition</b> <a href="#l00826">plugin.py:828</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a1993e16b2333cb1bb281eaa81828c326"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a1993e16b2333cb1bb281eaa81828c326">gulp.plugin.PluginBase._record_failed</a></div><div class="ttdeci">TmpIngestStats _record_failed(self, TmpIngestStats fs, any entry, str|dict source, Exception|str ex)</div><div class="ttdef"><b>Definition</b> <a href="#l00945">plugin.py:947</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a1e436b61f937ea687fa3897d286899cf"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a1e436b61f937ea687fa3897d286899cf">gulp.plugin.PluginBase.version</a></div><div class="ttdeci">str version(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00112">plugin.py:112</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a28ec6d78487be57c105863d9f58904e7"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a28ec6d78487be57c105863d9f58904e7">gulp.plugin.PluginBase._parser_failed</a></div><div class="ttdeci">TmpIngestStats _parser_failed(self, TmpIngestStats fs, str|dict source, Exception|str ex)</div><div class="ttdef"><b>Definition</b> <a href="#l00932">plugin.py:934</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a333f06e1a7df05effecbc6a8fa238cca"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a333f06e1a7df05effecbc6a8fa238cca">gulp.plugin.PluginBase.ws_id</a></div><div class="ttdeci">str ws_id</div><div class="ttdef"><b>Definition</b> <a href="#l00081">plugin.py:81</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a375c2c0b188733c1f35fcc20865965bf"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a375c2c0b188733c1f35fcc20865965bf">gulp.plugin.PluginBase._build_gulpdocuments</a></div><div class="ttdeci">list[GulpDocument] _build_gulpdocuments(self, list[FieldMappingEntry] fme, int idx, int operation_id, str context, str plugin, int client_id, str raw_event, str original_id, str src_file, int timestamp=None, int timestamp_nsec=None, str event_code=None, list[str] cat=None, int duration_nsec=0, GulpLogLevel gulp_log_level=None, str original_log_level=None, bool remove_raw_event=False, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00555">plugin.py:575</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a381f36429810987d7e1a4603c3f4dfea"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a381f36429810987d7e1a4603c3f4dfea">gulp.plugin.PluginBase._call_record_to_gulp_document_funcs</a></div><div class="ttdeci">list[GulpDocument] _call_record_to_gulp_document_funcs(self, int operation_id, int client_id, str context, str source, TmpIngestStats fs, any record, int record_idx, GulpMapping custom_mapping=None, dict index_type_mapping=None, str plugin=None, GulpPluginParams plugin_params=None, Callable record_to_gulp_document_fun=None, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00376">plugin.py:391</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a38a3b56e6818d69a12aa847ac980895e"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a38a3b56e6818d69a12aa847ac980895e">gulp.plugin.PluginBase.record_to_gulp_document</a></div><div class="ttdeci">list[GulpDocument] record_to_gulp_document(self, int operation_id, int client_id, str context, str source, TmpIngestStats fs, any record, int record_idx, GulpMapping custom_mapping=None, dict index_type_mapping=None, str plugin=None, GulpPluginParams plugin_params=None, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00455">plugin.py:469</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a3cc5beb95fb74f4be44c04f84ed66a82"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a3cc5beb95fb74f4be44c04f84ed66a82">gulp.plugin.PluginBase.name</a></div><div class="ttdeci">str name(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00124">plugin.py:124</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a400aabb1893cbe98511a69414c8e58a2"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a400aabb1893cbe98511a69414c8e58a2">gulp.plugin.PluginBase._flush_buffer</a></div><div class="ttdeci">TmpIngestStats _flush_buffer(self, str index, TmpIngestStats fs, str ws_id, str req_id, GulpIngestionFilter flt=None, bool wait_for_refresh=False)</div><div class="ttdef"><b>Definition</b> <a href="#l00857">plugin.py:865</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a48d7d6a080b67ba8c58522a1e05ce930"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a48d7d6a080b67ba8c58522a1e05ce930">gulp.plugin.PluginBase.type</a></div><div class="ttdeci">GulpPluginType type(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00106">plugin.py:106</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a4b661e5352802554dc25028526496f7b"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a4b661e5352802554dc25028526496f7b">gulp.plugin.PluginBase._map_source_key</a></div><div class="ttdeci">list[FieldMappingEntry] _map_source_key(self, GulpPluginParams plugin_params, GulpMapping custom_mapping, str source_key, Any v, dict index_type_mapping=None, bool ignore_custom_mapping=False, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00683">plugin.py:692</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a66de2da998fe4b3958a3a6ce1189fbe8"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a66de2da998fe4b3958a3a6ce1189fbe8">gulp.plugin.PluginBase.ingest_plugin_initialize</a></div><div class="ttdeci">tuple[dict, GulpMapping] ingest_plugin_initialize(self, str index, str|dict source, bool skip_mapping=False, ProcessingPipeline pipeline=None, str mapping_file=None, str mapping_id=None, GulpPluginParams plugin_params=None)</div><div class="ttdef"><b>Definition</b> <a href="#l00316">plugin.py:325</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a840f5d608e3e60e19ad6aca18e0b5abf"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a840f5d608e3e60e19ad6aca18e0b5abf">gulp.plugin.PluginBase.cleanup</a></div><div class="ttdeci">None cleanup(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00549">plugin.py:549</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_a85ca465c1498add707b193266a2dc717"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#a85ca465c1498add707b193266a2dc717">gulp.plugin.PluginBase.elastic</a></div><div class="ttdeci">elastic</div><div class="ttdef"><b>Definition</b> <a href="#l00084">plugin.py:84</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_aa28dc103258589d9cb421197fe2de90b"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#aa28dc103258589d9cb421197fe2de90b">gulp.plugin.PluginBase.path</a></div><div class="ttdeci">path</div><div class="ttdef"><b>Definition</b> <a href="#l00082">plugin.py:82</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ab96082a9ecc6d0db5a48ee6958ac3239"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ab96082a9ecc6d0db5a48ee6958ac3239">gulp.plugin.PluginBase.ingest</a></div><div class="ttdeci">GulpRequestStatus ingest(self, str index, str req_id, int client_id, int operation_id, str context, str|list[dict] source, str ws_id, GulpPluginParams plugin_params=None, GulpIngestionFilter flt=None, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00496">plugin.py:508</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_abf39f32a2e7e60975eac7054393625da"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#abf39f32a2e7e60975eac7054393625da">gulp.plugin.PluginBase._process_record</a></div><div class="ttdeci">tuple[TmpIngestStats, bool] _process_record(self, str index, any record, int record_idx, Callable my_record_to_gulp_document_fun, str ws_id, str req_id, int operation_id, int client_id, str context, str source, TmpIngestStats fs, GulpMapping custom_mapping=None, dict index_type_mapping=None, str plugin=None, GulpPluginParams plugin_params=None, GulpIngestionFilter flt=None, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00240">plugin.py:259</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ac39f95b7470b242061ba67ee749c4b44"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ac39f95b7470b242061ba67ee749c4b44">gulp.plugin.PluginBase._process_plugin_params</a></div><div class="ttdeci">tuple[GulpMapping, GulpPluginParams] _process_plugin_params(self, GulpMapping custom_mapping, GulpPluginParams plugin_params=None)</div><div class="ttdef"><b>Definition</b> <a href="#l00166">plugin.py:168</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ac5c86b4ede215ac0ba20d028ad717c3e"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ac5c86b4ede215ac0ba20d028ad717c3e">gulp.plugin.PluginBase.get_unmapped_field_name</a></div><div class="ttdeci">str get_unmapped_field_name(self, str field)</div><div class="ttdef"><b>Definition</b> <a href="#l00623">plugin.py:623</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ac6a9f9fea14049c9afb7094bb617363f"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ac6a9f9fea14049c9afb7094bb617363f">gulp.plugin.PluginBase.internal</a></div><div class="ttdeci">bool internal(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00147">plugin.py:147</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_acc159cfa2b2d043ffa24a5f62e5c80a3"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#acc159cfa2b2d043ffa24a5f62e5c80a3">gulp.plugin.PluginBase.pipeline</a></div><div class="ttdeci">ProcessingPipeline pipeline(self, GulpPluginParams plugin_params=None, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00535">plugin.py:537</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_acc17a69ceae0067ad2cc9bba5fe59fe9"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#acc17a69ceae0067ad2cc9bba5fe59fe9">gulp.plugin.PluginBase.tags</a></div><div class="ttdeci">list[str] tags(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00153">plugin.py:153</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_acfc929fce907dcf945a52ffb8dc5b2ed"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#acfc929fce907dcf945a52ffb8dc5b2ed">gulp.plugin.PluginBase._type_checks</a></div><div class="ttdeci">any _type_checks(self, any v, str k, dict index_type_mapping)</div><div class="ttdef"><b>Definition</b> <a href="#l00638">plugin.py:638</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ad1f1eb15a79c7b61e759632d9333976b"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ad1f1eb15a79c7b61e759632d9333976b">gulp.plugin.PluginBase.operation_id</a></div><div class="ttdeci">str operation_id</div><div class="ttdef"><b>Definition</b> <a href="#l00079">plugin.py:79</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ad23a45a663b1933199b70ae3631e451b"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ad23a45a663b1933199b70ae3631e451b">gulp.plugin.PluginBase.desc</a></div><div class="ttdeci">str desc(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00118">plugin.py:118</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ad79ad6ef42363d02816e4b70b1c56fb5"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ad79ad6ef42363d02816e4b70b1c56fb5">gulp.plugin.PluginBase.event_type_field</a></div><div class="ttdeci">str event_type_field(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00129">plugin.py:129</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ad7e45821be80096c2a8b7c47f7ac1eed"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ad7e45821be80096c2a8b7c47f7ac1eed">gulp.plugin.PluginBase.__init__</a></div><div class="ttdeci">None __init__(self, str path, AsyncEngine collab=None, AsyncElasticsearch elastic=None, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00060">plugin.py:66</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ad9cf9630b6d3e7ae9eab1b880e786222"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ad9cf9630b6d3e7ae9eab1b880e786222">gulp.plugin.PluginBase._ingest_record</a></div><div class="ttdeci">TmpIngestStats _ingest_record(self, str index, GulpDocument|dict doc, TmpIngestStats fs, str ws_id, str req_id, GulpIngestionFilter flt=None, bool flush_enabled=True, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l00910">plugin.py:920</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_adafcb65c64ccf4cd7aa243765c95cc92"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#adafcb65c64ccf4cd7aa243765c95cc92">gulp.plugin.PluginBase.logger</a></div><div class="ttdeci">logging.Logger logger(cls)</div><div class="ttdef"><b>Definition</b> <a href="#l00095">plugin.py:95</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_ae7a969999e7d7be46f79b575de5f2224"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#ae7a969999e7d7be46f79b575de5f2224">gulp.plugin.PluginBase.options</a></div><div class="ttdeci">list[GulpPluginOption] options(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00099">plugin.py:99</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_aed88676be607a3199e7b417512f3d8f1"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#aed88676be607a3199e7b417512f3d8f1">gulp.plugin.PluginBase.context</a></div><div class="ttdeci">tuple context</div><div class="ttdef"><b>Definition</b> <a href="#l00080">plugin.py:80</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin_1_1_plugin_base_html_af2760b1eea7c1b7f2459abf2872cbac6"><div class="ttname"><a href="classgulp_1_1plugin_1_1_plugin_base.html#af2760b1eea7c1b7f2459abf2872cbac6">gulp.plugin.PluginBase.collab</a></div><div class="ttdeci">collab</div><div class="ttdef"><b>Definition</b> <a href="#l00083">plugin.py:83</a></div></div>
<div class="ttc" id="aclassgulp_1_1plugin__internal_1_1_gulp_plugin_params_html"><div class="ttname"><a href="classgulp_1_1plugin__internal_1_1_gulp_plugin_params.html">gulp.plugin_internal.GulpPluginParams</a></div><div class="ttdef"><b>Definition</b> <a href="plugin__internal_8py_source.html#l00007">plugin_internal.py:7</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin__internal_html"><div class="ttname"><a href="namespacegulp_1_1plugin__internal.html">gulp.plugin_internal</a></div><div class="ttdef"><b>Definition</b> <a href="plugin__internal_8py_source.html#l00001">plugin_internal.py:1</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a01189de942f84e5d69c99d4e9ed054c7"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a01189de942f84e5d69c99d4e9ed054c7">gulp.plugin.get_plugin_tags</a></div><div class="ttdeci">list[str] get_plugin_tags(str plugin)</div><div class="ttdef"><b>Definition</b> <a href="#l01118">plugin.py:1118</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a0b74780046e4ade35e214c7f2926d02c"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a0b74780046e4ade35e214c7f2926d02c">gulp.plugin.init</a></div><div class="ttdeci">init(logging.Logger logger)</div><div class="ttdef"><b>Definition</b> <a href="#l00047">plugin.py:47</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a0e97ab32e715777b3ab97717986e594f"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a0e97ab32e715777b3ab97717986e594f">gulp.plugin.unload_plugin</a></div><div class="ttdeci">None unload_plugin(PluginBase mod)</div><div class="ttdef"><b>Definition</b> <a href="#l01132">plugin.py:1132</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a1c5c9184d00e49a445eb6b8f77ad60a3"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a1c5c9184d00e49a445eb6b8f77ad60a3">gulp.plugin.plugin_cache_add</a></div><div class="ttdeci">None plugin_cache_add(ModuleType m, str name)</div><div class="ttdef"><b>Definition</b> <a href="#l01193">plugin.py:1193</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a49455ddc351f40d6438de1a81a68d742"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a49455ddc351f40d6438de1a81a68d742">gulp.plugin.plugin_cache_remove</a></div><div class="ttdeci">None plugin_cache_remove(str plugin)</div><div class="ttdef"><b>Definition</b> <a href="#l01171">plugin.py:1171</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a5af35dd01859f67f273a67cc0c774701"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a5af35dd01859f67f273a67cc0c774701">gulp.plugin.list_plugins</a></div><div class="ttdeci">list[dict] list_plugins()</div><div class="ttdef"><b>Definition</b> <a href="#l01082">plugin.py:1082</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a714b6e278c22eb32907dd3d4afa0b56d"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a714b6e278c22eb32907dd3d4afa0b56d">gulp.plugin.plugin_cache_clear</a></div><div class="ttdeci">None plugin_cache_clear()</div><div class="ttdef"><b>Definition</b> <a href="#l01157">plugin.py:1157</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a8d88e1de40580ca31b2c05838fdfc03f"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a8d88e1de40580ca31b2c05838fdfc03f">gulp.plugin.plugin_cache_get</a></div><div class="ttdeci">ModuleType plugin_cache_get(str plugin)</div><div class="ttdef"><b>Definition</b> <a href="#l01214">plugin.py:1214</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_a9b05fe36b952a46571666d228d193558"><div class="ttname"><a href="namespacegulp_1_1plugin.html#a9b05fe36b952a46571666d228d193558">gulp.plugin.load_plugin</a></div><div class="ttdeci">PluginBase load_plugin(str plugin, AsyncEngine collab=None, AsyncElasticsearch elastic=None, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l01030">plugin.py:1035</a></div></div>
<div class="ttc" id="anamespacegulp_1_1plugin_html_abb00832220a7a4b752ad4e752efdc946"><div class="ttname"><a href="namespacegulp_1_1plugin.html#abb00832220a7a4b752ad4e752efdc946">gulp.plugin._get_plugin_path</a></div><div class="ttdeci">str _get_plugin_path(str plugin, **kwargs)</div><div class="ttdef"><b>Definition</b> <a href="#l01010">plugin.py:1010</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<script>
    mermaid.initialize({
        startOnLoad: true,
        theme: "dark",
    });
</script>
